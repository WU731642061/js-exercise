(window.webpackJsonpwebpackLogReporter=window.webpackJsonpwebpackLogReporter||[]).push([[2],{88:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=i(t(2)),n=i(t(26));function i(e){return e&&e.__esModule?e:{default:e}}function a(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var s=function(){function e(){!function(e,r){if(!(e instanceof r))try{throw new TypeError("Cannot call a class as a function")}catch(e){}}(this,e),this.browser=o.default.myBrowser(),this.reportUrls=["//api.bilibili.com/x/web-interface/cdn/report?from=report","//i0.hdslb.com/bfs/test/ce1cf20203c303963e78c811b01100667c960bba.png"],this.headers={},this.reqFinished=0,this.collectUrlInfo()}var r,t,i;return r=e,(t=[{key:"getHeader",value:function(e,r){var t=e.getAllResponseHeaders();if(t.indexOf(r.toLowerCase())>-1){var o=new RegExp(r,"i"),n=t.match(o)[0];return e.getResponseHeader(n)}return""}},{key:"collectUrlInfo",value:function(){var e=this;this.reportUrls.forEach(function(r,t){var o=n.default.ajax({url:r,noCredentials:!0,success:function(r){var n=e.getHeader(o,"x-cache-webcdn"),i=e.getHeader(o,"x-service-module");e.headers[t]={cdn:n,protocol:i},e.reqFinished++,e.reqFinished===e.reportUrls.length&&e.reportCdn()},fail:function(){e.reqFinished++,e.reqFinished===e.reportUrls.length&&e.reportCdn()}})})}},{key:"getResourceList",value:function(){return window.performance&&"function"==typeof performance.getEntriesByType?performance.getEntriesByType("resource"):[]}},{key:"matchUrl",value:function(e){for(var r=0;r<this.reportUrls.length;r++)if(e.indexOf(this.reportUrls[r])>-1)return r;return-1}},{key:"reportCdn",value:function(){var e=this;this.getResourceList().forEach(function(r){var t=e.matchUrl(r.name);t>-1&&e.todo({cdn_addr:e.headers[t].cdn,protocol:e.headers[t].protocol||r.nextHopProtocol,uri:document.baseURI||window.location.href,request_uri:o.default.splitUrlArgs(r.name).path,referrer:document.referrer||"",dns_time:r.domainLookupEnd-r.domainLookupStart,connect_time:r.connectEnd-r.connectStart,request_time:r.responseStart-r.requestStart,response_time:r.responseEnd-r.responseStart,consumer_time:r.duration,request_args:o.default.splitUrlArgs(r.name).args,initiator_type:r.initiatorType,error:""},!0)})}},{key:"todo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0,t={log_id:200001,browser:this.browser,uri:e.uri,user_agent:navigator.userAgent,mid:Number(o.default.getCookie("DedeUserID")||0),buvid:o.default.getCookie("buvid3")||"",referrer:e.referrer,extended_fields:{cdn_addr:e.cdn_addr,request_uri:e.request_uri||"",start_request_ts:(Math.floor(e.start_request_ts)||Date.parse(new Date)/1e3).toString(),dns_time:(Math.floor(e.dns_time)||"0").toString(),hit_cache:e.hit_cache||"",cdn_hostname:e.cdn_hostname||"",idc:e.idc||"",connect_time:(Math.floor(e.connect_time)||"0").toString(),request_time:("0"|Math.floor(e.request_time)).toString(),response_time:(Math.floor(e.response_time)||"0").toString(),consumer_time:(Math.floor(e.consumer_time)||"0").toString(),request_args:encodeURI(e.request_args||""),initiator_type:String.prototype.toLocaleLowerCase.call(e.initiator_type||""),error:void 0==e.error?"error":e.error}};r&&(t.extended_fields.protocol=e.protocol),n.default.post("//apm-misaka.biliapi.net/misaka/web/report?cross_domain=true",JSON.stringify(t))}}])&&a(r.prototype,t),i&&a(r,i),e}();r.default=s}}]);