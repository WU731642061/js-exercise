/*
BUILT_AT: 2019年12月2日 11:20
*/
!function(t){function e(e){for(var i,r,s=e[0],u=e[1],f=e[2],c=0,d=[];c<s.length;c++)r=s[c],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&d.push(o[r][0]),o[r]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(t[i]=u[i]);for(l&&l(e);d.length;)d.shift()();return a.push.apply(a,f||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,s=1;s<n.length;s++){var u=n[s];0!==o[u]&&(i=!1)}i&&(a.splice(e--,1),t=r(r.s=n[0]))}return t}var i={},o={3:0},a=[];function r(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="//s2.hdslb.com/bfs/static/blive/blfe-message-navbar/";var s=("undefined"!=typeof self?self:this).webpackJsonp=("undefined"!=typeof self?self:this).webpackJsonp||[],u=s.push.bind(s);s.push=e,s=s.slice();for(var f=0;f<s.length;f++)e(s[f]);var l=u;a.push([184,1,0]),n()}({123:function(t,e,n){},184:function(t,e,n){"use strict";n.r(e);var i=n(30),o=n.n(i),a=(n(123),n(31),n(26),n(91),n(13),n(66),n(27),n(69),n(16),n(94),n(22),n(73),n(99),n(75),n(6)),r=n.n(a),s=(n(76),n(14));function u(t,e,n,i,o,a,r){try{var s=t[a](r),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(i,o)}function f(t){return function(){var e=this,n=arguments;return new Promise(function(i,o){var a=t.apply(e,n);function r(t){u(a,i,o,r,s,"next",t)}function s(t){u(a,i,o,r,s,"throw",t)}r(void 0)})}}var l,c,d={data:function(){return{uid:"",notifyCounts:{at_me:0,reply_me:0,praise_me:0,notify_me:0,message:0},notifyType:0,availableNotifyType:[0,1,2],unfollowFold:!1,im_list:[{name:"reply_me",text:"回复我的",href:"//message.bilibili.com/#/reply"},{name:"at_me",text:"@我的",href:"//message.bilibili.com/#/at"},{name:"praise_me",text:"收到的赞",href:"//message.bilibili.com/#/love"},{name:"notify_me",text:"系统通知",href:"//message.bilibili.com/#/system"},{name:"message",text:"我的消息",href:"//message.bilibili.com/#/whisper"}]}},watch:{notifyCounts:{handler:function(){this.postMessage()},deep:!0},notifyType:function(){this.postMessage()}},mounted:(c=f(r.a.mark(function t(){var e=this;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([this.getUid(),this.getNotifyType(),this.getnotifyCounts()]);case 2:return t.next=4,this.getUnreadMessageCount(!0);case 4:setInterval(function(){e.getUnreadMessageCount()},6e4),window.addEventListener("storage",function(t){t.key==="imNotifyCounts".concat(e.uid)?e.notifyCounts=JSON.parse(t.newValue):t.key==="im_notify_type_".concat(e.uid)&&(e.notifyType=parseInt(t.newValue))});case 6:case"end":return t.stop()}},t,this)})),function(){return c.apply(this,arguments)}),methods:{getUid:function(){var t=this;return Object(s.a)({addPlatInfo:!0,url:"//api.bilibili.com/x/web-interface/nav",method:"get"}).then(function(e){t.uid=e.data.mid})},getUnreadMessageCount:(l=f(r.a.mark(function t(){var e,n,i,o=this,a=arguments;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=a.length>0&&void 0!==a[0]&&a[0],n=function(){var t=f(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(s.a)({addPlatInfo:!0,url:"//api.vc.bilibili.com/session_svr/v1/session_svr/single_unread",method:"get",data:{unread_type:0}}).then(function(t){return o.unfollowFold?t.data.follow_unread:t.data.follow_unread+t.data.unfollow_unread});case 2:o.notifyCounts.message=t.sent,localStorage.setItem("imNotifyCounts".concat(o.uid),JSON.stringify(o.notifyCounts)),localStorage.setItem("unreadApiRequestedBy".concat(o.uid,"At"),Date.now());case 5:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),e?n():parseInt(localStorage.getItem("unreadApiRequestedBy".concat(this.uid,"At")))+6e4>Date.now()?(i=JSON.parse(localStorage.getItem("imNotifyCounts".concat(this.uid)))||{},this.notifyCounts.message=parseInt(i.message)||0):n();case 3:case"end":return t.stop()}},t,this)})),function(){return l.apply(this,arguments)}),getnotifyCounts:function(){var t=this;return Object(s.a)({addPlatInfo:!0,url:"//api.bilibili.com/x/msgfeed/unread",method:"get"}).then(function(e){0===e.code&&(t.notifyCounts=Object.assign(t.notifyCounts,{at_me:e.data.at,reply_me:e.data.reply,praise_me:e.data.like,notify_me:e.data.sys_msg}))})},getNotifyType:function(){var t=this;return Object(s.a)({addPlatInfo:!0,url:"//api.vc.bilibili.com/link_setting/v1/link_setting/get",method:"get",data:{msg_notify:1,show_unfollowed_msg:1}}).then(function(e){if(0===e.code){var n=e.data.msg_notify-1;t.availableNotifyType.indexOf(n)>-1&&(t.notifyType=n),t.unfollowFold=1===Number(e.data.show_unfollowed_msg)}})},postMessage:function(){var t=this,e=Object.keys(this.notifyCounts).reduce(function(e,n){return e+t.notifyCounts[n]},0);window.parent.postMessage({type:"nav-im-update",count:e,notifyType:this.notifyType},"*")},displayCount:function(t){return t>99?"99+":t}}},p=n(57),m=Object(p.a)(d,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"im-root"},[n("div",{staticClass:"im-list-box"},t._l(t.im_list,function(e){return n("a",{key:e.name,staticClass:"im-list",attrs:{href:e.href,target:"_blank"}},[t._v("\n      "+t._s(e.text)+"\n      "),0===t.notifyType&&t.notifyCounts[e.name]>0?n("span",{staticClass:"im-notify im-number im-center"},[t._v(t._s(t.displayCount(t.notifyCounts[e.name])))]):t._e(),1===t.notifyType&&t.notifyCounts[e.name]>0?n("span",{staticClass:"im-notify im-dot im-center"}):t._e()])}),0)])},[],!1,null,null,null).exports;o.a.config.productionTip=!1,new o.a({render:function(t){return t(m)}}).$mount("#nav-im-part")}});