!function(t){function e(o){if(i[o])return i[o].exports;var a=i[o]={exports:{},id:o,loaded:!1};return t[o].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){t.exports=i(4)},function(t,e){var i={uncurryThis:function(t){return function(){return t.call.apply(t,arguments)}},curryThis:function(t){return function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),t.apply(null,e)}},bindFn:function(t,e){var i=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,i.concat(Array.prototype.slice.call(arguments)))}},extend:function(t,e){function i(){}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.__super__=e.prototype,t},mixin:function(t){for(var e=Array.prototype.slice.call(arguments,1),i=0;i<e.length;i++){var o=e[i];for(var a in o)t[a]||(t[a]=o[a])}},distinctArray:function(t){for(var e,i=[],o={},a=0;a<t.length;a++){e=t[a];var s=e+":"+typeof e;o[s]||(i.push(e),o[s]=!0)}return i},browser:{version:function(){var t=navigator.userAgent;return navigator.appVersion,{trident:/Trident/i.test(t),presto:/Presto/i.test(t),webKit:/AppleWebKit/i.test(t),gecko:/Gecko/i.test(t)&&!/KHTML/i.test(t),mobile:/AppleWebKit.*Mobile.*/i.test(t),ios:/\(i[^;]+;( U;)? CPU.+Mac OS X/i.test(t),android:/Android/i.test(t)||/Linux/i.test(t),windowsphone:/Windows Phone/i.test(t),iPhone:/iPhone/i.test(t),iPad:/iPad/i.test(t),MicroMessenger:/MicroMessenger/i.test(t),webApp:!/Safari/i.test(t),edge:/edge/i.test(t),weibo:/Weibo/i.test(t),uc:/UCBrowser/i.test(t),qq:/MQQBrowser/i.test(t),baidu:/Baidu/i.test(t)}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase(),lteIE:function(t){return $.browser.msie&&parseInt($.browser.version)<=t}},cookie:{get:function(t){var e=""+document.cookie,i=e.indexOf(t+"=");if(i==-1||""==t)return"";var o=e.indexOf(";",i);return o==-1&&(o=e.length),unescape(e.substring(i+t.length+1,o))},set:function(t,e,i){i=void 0!==i?i:365;var o=new Date;o.setTime(o.getTime()+24*i*60*60*1e3),document.cookie=t+"="+escape(e)+";expires="+o.toGMTString()+"; path=/; domain=.bilibili.com"},delete:function(t){this.set(t,"",-1)}},readFromLocal:function(t){return this.localStorage._support?localStorage.getItem(t):this.cookie.get(t)},saveToLocal:function(t,e,i){return this.localStorage._support?localStorage.setItem(t,e):this.cookie.set(t,e,i)},localStorage:{_support:!(!window.localStorage||"object"!=typeof window.localStorage),getItem:function(t){return this._support?window.localStorage.getItem(t):null},setItem:function(t,e){this._support&&window.localStorage.setItem(t,e)},removeItem:function(t){this.getItem(t)&&window.localStorage.removeItem(t)}},unhtml:function(t,e){return t?t.replace(e||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g,function(t,e){return e?t:{"<":"","&":"",'"':"",">":"","'":""}[t]}):""},html:function(t){return t?t.replace(/&((g|l|quo)t|amp|#39|nbsp);/g,function(t){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'","&nbsp;":" "}[t]}):""},hashManage:{prependHash:"!",_change:function(t,e){var i,o=location.hash,a={},s="",n=0;o&&(o=o.substring(1),this.prependHash&&(o=o.replace(new RegExp("^"+this.prependHash.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")),""))),i=o.split("&");for(var r=0;r<i.length;r++){var l=i[r].split("=")[0],c=i[r].split("=")[1];l&&(a[l]=decodeURIComponent(c))}if("object"==typeof t)for(var d in t){var p=t[d];p?a[d]=encodeURIComponent(p):p===!1&&delete a[d]}else if(e)a[t]=encodeURIComponent(e);else{if(e!==!1)return"undefined"==typeof t?a:a[t]||null;delete a[t]}for(var m in a)s+=0!=n?"&":this.prependHash,s+=m+"="+a[m],n++;return location.hash=s,a},get:function(t){return this._change(t,null)},set:function(t,e){return this._change(t,e)},clear:function(){location.hash=""}},getColor16:function(t){function e(t){var e=parseInt(t).toString(16);return 1==e.length?"0"+e:e}function i(t){for(var i="#",o=0;o<3;o++)i+=e(t[o]);return i}var o="",a=[];return null!=t.match(/\((.*)\)/)?(a=t.match(/\((.*)\)/)[1].split(","),o=i(a)):null!=t.match(/,+/g)?(a=t.split(","),o=i(a)):o=e(t),o},serializeParam:function(t){var e=[];for(var i in t)if("function"!=(typeof t[i]).toLowerCase()&&"object"!=(typeof t[i]).toLowerCase())e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));else if($.isArray(t[i]))for(var o=0;o<t[i].length;o++)e.push(encodeURIComponent(i)+"[]="+encodeURIComponent(t[i][o]));return e.join("&")},query2json:function(t){if($.isPlainObject(t))return t;if(void 0===t)return{};for(var e=t.split("&"),i={},o=0;o<e.length;o++){var a=e[o].split("=");i[a[0]]=a[1]}return i},hash2json:function(){return window.location.href.split("#").length>1?this.query2json(window.location.href.split("#")[1].split("?")[0].replace(/#/,"")):{}},query:{get:function(t){var e=i.query2json(this._getQuery());return t?e[t]:e},set:function(t,e){var o=i.query2json(this._getQuery()),a=i.hash2json();if("object"==typeof t)for(var s in t)this._set(o,s,t[s]);else this._set(o,t,e);return i.makeUrl("",o,a)},_set:function(t,e,i){return null===i?delete t[e]:t[e]=i,t},_getQuery:function(){return void 0!==window.location.search?window.location.search.substring(1):window.location.href.split("?")[1]?window.location.href.split("?")[1].split("#")[0]:""}},makeUrl:function(t,e,i){var o,a=this.serializeParam(e),s=this.serializeParam(i);return o=a?(t||location.pathname)+"?"+a:t||location.pathname,s&&(o=o+"#"+s),o},formatNum:function(t,e){if(void 0===t||"string"==typeof t&&isNaN(parseInt(t)))return"--";var i={"万":1e4},o="万";e="string"==typeof e?e:o;var a=i[e]||i[o];if(!("string"==typeof t&&t.indexOf(e)>=0)){if("string"==typeof t&&t.indexOf(",")>=0){for(var s=t.split(","),n="",r=0;r<s.length;r++)n+=s[r];t=n}return t=parseInt(t),t>=a&&(t=(t/a).toFixed(1)+e),t}},parseCardProps:function(t,e){var i={"data-gk":t.play,"data-sc":t.favorites,"data-pl":t.review,"data-dm":t.video_review,"data-up":t.author,"data-subtitle":t.subtitle,"data-lm":t.typename||"","data-tg":t.created?new Date(1e3*t.created).format("yyyy-MM-dd hh:mm"):t.create||t.created_at,"data-txt":t.description,"data-yb":t.coins},o="";if("string"==e){for(var a in i)""!=o&&(o+=" "),o+=a+'="'+i[a]+'"';return o}return i},newParseCardProps:function(t,e){var i={"data-gk":t.stat.view,"data-sc":t.stat.favorite,"data-pl":t.stat.reply,"data-dm":t.stat.danmaku,"data-up":t.owner.name,"data-lm":t.tname||"","data-tg":new Date(1e3*t.pubdate).format("yyyy-MM-dd hh:mm"),"data-txt":t.desc,"data-yb":t.stat.coin};return i},protocolRelative:function(t){return/http:|https:/.test(t)?t.replace(/http:|https:/,window.location.protocol):$.browser.msie&&parseInt($.browser.version)<=8?window.location.protocol+t:t},formatDuration:function(t,e,i){if("number"!=typeof t)return t;i=i||-1;var o=this.toFixed(t%60,2),a=e?this.toFixed(Math.floor(t%3600/60),2):this.toFixed(Math.floor(t/60),i),s=e?this.toFixed(Math.floor(t/3600),i):null;return null===s?[a,o].join(":"):[s,a,o].join(":")},isObject:function(t){return"object"==typeof t&&null!==t},isNothing:function(t){return null==t},isUndefined:function(t){return"undefined"==typeof t},join:function(){return Array.prototype.join.call(arguments,"")},random:function(t,e){return this.isNothing(e)&&(e=t,t=0),Math.floor(Math.random()*(e-t+1))+t},debounce:function(t,e,o){function a(){clearTimeout(s),o&&i.isNothing(s)&&t(),s=setTimeout(t,e||100)}var s;return a.clearNext=function(){clearTimeout(s)},a},throttle:function(t,e,i){function o(){n=i.head?0:(new Date).getTime(),s=null,t()}function a(){var a,r=(new Date).getTime();!n&&i.head&&(n=r),a=e-(r-n),a<=0||a>e?(clearTimeout(s),s=null,n=r,t()):s||i.tail||(s=setTimeout(o,a))}var s,n=0;return e=e||200,i=i||{},a.clearNext=function(){clearTimeout(s),s=null,n=0},a},toFixed:function(t,e){if("number"!=typeof t&&"string"!=typeof t)return t;for(t=String(t),e=Number(e)||2;t.length<e;)t="0"+t;return t.length>e?t:t.slice(-e)},thumbnail:function(t,e,i){if("string"!=typeof t)return t;if("undefined"==typeof e)return t;var o,a,s,n,r=t.split("?");return i=i||e,o={midfix:"/"+e+"_"+i,suffix:"_"+e+"x"+i},a={cdn:/^http.+i[0-2]\.hdslb\.com\//,bfs:/^http.+i\d\.hdslb\.com\/bfs\//,group1:/^http.+i\d\.hdslb\.com\/group1\//,other:/(^http.+i\d\.hdslb\.com)(\/.+)/},s={bfs:/_\d+x\d+\./,other:/\/\d+_\d+\//},a.cdn.test(r[0])?s.bfs.test(r[0])||s.other.test(r[0])?t:(a.bfs.test(r[0])||a.group1.test(r[0])?(r[0]+=o.suffix+r[0].slice(r[0].lastIndexOf(".")),t=r.join("?")):(n=a.other.exec(r[0]),n&&(r[0]=n[1]+o.midfix+n[2],t=r.join("?"))),t):t},isWebp:function(){try{return 0==document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}catch(t){return!1}}(),webp:function(t,e){if(!t)return t;var i=t.match(/(.*\.(jpg|jpeg|gif|png|bmp))(\?.*)?/),o=t.indexOf("/bfs/")!=-1;if(!i||"gif"===i[2]||"bmp"===i[2]||!o)return t;var a=e.w,s=e.h,n=a&&s?"@"+a+"w_"+s+"h":"@",e=i[3]?i[3]:"";return this.isWebp?i[1]+n+".webp"+e:i[1]+n+"."+i[2]+e},isAlpha:function(t,e){var i;return localStorage.getItem("machineDna")?i=localStorage.getItem("machineDna"):(i=parseInt(10*Math.random()+1),localStorage.setItem("machineDna",i)),!!(this.isBeta(t)||e<i)},isBeta:function(t){var e=!1,o=i.cookie.get("DedeUserID").slice(-1);return o&&$.isArray(t)&&(e=$.inArray(+o,t)>-1),e},trimHttp:function(t){return t?t.replace(/^http:/,""):""},getByteLen:function(t){for(var e=0,i=0;i<t.length;i++){var o=t.charAt(i);e+=null!=o.match(/[^\x00-\xff]/gi)?1:.5}return e},videoReport:function(t){window.spmReportData&&(window.spmReportData[t]=t)},customReport:function(t,e){if(window.reportConfig&&window[reportConfig.msgObjects]){var i=window[reportConfig.msgObjects],o=e?e:t;i[t]=o}},formatLotteryTime:function(t){t*=1e3;var e=new Date(t),i=e.getFullYear(),o=e.getMonth()+1,a=e.getDate(),s=e.getHours(),n=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes();return i+"年"+o+"月"+a+"日 "+s+":"+n}};t.exports=i},function(t,e){function i(){}i.prototype={addBlacklist:function(t,e,i){var o=e?e:null;$.ajax({url:"//api.bilibili.com/x/relation/modify?cross_domain=true",type:"POST",data:{fid:t,act:5,re_src:i||15},xhrFields:{withCredentials:!0}}).done(function(t){o(t)})},follow:function(t,e,i){var o=e?e:null;$.ajax({url:"//api.bilibili.com/x/relation/modify?cross_domain=true",type:"POST",data:{fid:t,act:1,re_src:i||15},xhrFields:{withCredentials:!0}}).done(function(t){o(t)})},whisperUser:function(t,e){var i=e?e:null;this.todoFriend({act:"add",attention:0,format:"json",uid:t},i)},unFollow:function(t,e,i,o){var a=e?e:null;$.ajax({url:"//api.bilibili.com/x/relation/modify?cross_domain=true",type:"POST",data:{fid:t,act:i?4:2,re_src:o||15},xhrFields:{withCredentials:!0}}).done(function(t){a(t)})},delFans:function(t,e){var i=e?e:null;this.todoFriend({act:"delFans",attention:0,format:"json",uid:t},i)}},t.exports=i},function(t,e,i){function o(t){if(this.params={evType:"over",center:!0,Overlap:!1,focusShowPos:"up",zIndex:null,animation:"fade",position:null,event:null,bound:!0,margin:5,backdrop:!1,bindInput:!1},"string"==typeof t&&(t={evType:t}),"object"==typeof t)for(var e in this.params)t.hasOwnProperty(e)&&(this.params[e]=t[e])}i(7);var a=2e4;o.prototype={timer:null,msgbox:null,bindobj:null,backobj:null,incomingTimer:null,position:{},reverseMap:{up:"down",down:"up",left:"right",right:"left"},show:function(t,e,i,o,s){if(t=$(t),0!=this.params.Overlap||"yes"!=t.attr("hasMessageBox")){t.attr("hasMessageBox","yes"),"undefined"==typeof i&&(i=1e3),"undefined"==typeof o&&(o="msg"),"button"==i&&(s=o,o=i,i=1e3);var n=i;0==i&&(n=50);var r=this;return r.leftTimer=function(){"button"!=o&&(clearTimeout(r.timer),r.timer=setTimeout(function(){clearTimeout(r.timer),r.close(r)},n))},r.incomingTimer=function(){clearTimeout(r.timer)},this.bindobj=t,this.msgbox=$('<div class="m-layer m_layer"><div class="bg"><div class="content"><div class="mini"><div class="msg-text"><i class="b-icon"></i>'+e+"</div>"+("button"==o?'<div class="btnbox"><a class="b-btn ok">确认</a><a class="b-btn-cancel cancel">取消</a></div>':"")+"</div></div></div></div>").prependTo("body"),this.msgbox.addClass("m-"+o),r.params.backdrop&&(r.backobj=$('<div class="m-backdrop"></div>').css({position:"fixed",top:0,left:0,right:0,bottom:0,opacity:.6,backgroundColor:"#000",zIndex:(r.params.zIndex||a)-1}).appendTo("body")),"over"==this.params.evType?(t.bind("mouseleave",r.leftTimer),t.bind("mouseenter",r.incomingTimer),this.msgbox.bind("mouseenter",function(){clearTimeout(r.timer)}),this.msgbox.bind("mouseleave",r.leftTimer)):t.bind("blur",r.leftTimer),this.setPos(),this.msgbox.css("z-index",r.params.zIndex||a++),this.params.bindInput&&"error"==o&&(t.is(":text")||t.is("textarea")?t.addClass("error").on("focus.m-error",this.closeErrHandler()):t.find(":text,textarea").length>0&&t.addClass("error").find(":text,textarea").on("focus.m-error",this.closeErrHandler())),"button"==o&&(this.msgbox.find(".ok").click(function(){"undefined"!=typeof s&&0==s(r)||r.close()}),this.msgbox.find(".cancel").click(function(){r.close()})),0!=i&&r.leftTimer(),"fade"!=this.params.animation?this.msgbox.addClass(this.params.animation):this.moveIn(this.params.focusShowPos),this.bindobj.data("b-msgbox",this),this.msgbox}},close:function(){var t=this,e=function(){t.msgbox.remove(),t.params.backdrop&&t.backobj.remove(),"over"==t.params.evType&&t.bindobj.off("mouseenter",t.incomingTimer),t.bindobj.off("over"==t.params.evType?"mouseleave":"blur",t.leftTimer)};this.bindobj.attr("hasMessageBox",""),"fade"!=this.params.animation?this.msgbox.removeClass(this.params.animation).fadeOut(200,e):this.msgbox.fadeOut(200,e)},closeErrHandler:function(){var t=this;return function(){var e=t.bindobj.removeClass("error");t.close(),e.is(":text")||e.is("textarea")?e.off("focus.m-error"):e.find(":text,textarea").length>0&&e.find(":text,textarea").off("focus.m-error")}},moveIn:function(t){var e={opacity:1},i=5,o=5;switch(t){case"up":e.top="-=5",o=0;break;case"down":e.top="+=5",i=-i,o=0;break;case"left":e.left="-=5",i=0;break;case"right":e.left="+=5",o=-o,i=0;break;default:e.top="-=5",o=0}this.msgbox.show().css({top:this.position.top+i,left:this.position.left+o,opacity:0}),this.msgbox.animate(e,200)},setPos:function(){this.params.position?(this.position=this.params.position,this.resetBound()):this._pos(this.params.focusShowPos),this.msgbox.css("left",this.position.left),this.msgbox.css("top",this.position.top)},_pos:function(t,e){var i=this.bindobj;switch(this.params.focusShowPos=t,t){case"up":this.position.top=i.offset().top-this.msgbox.outerHeight()-this.params.margin,this.position.left=i.offset().left,this.params.center&&(this.position.left=this.position.left-this.msgbox.outerWidth()/2+i.outerWidth()/2);break;case"down":this.position.top=i.offset().top+i.outerHeight()+this.params.margin,this.position.left=i.offset().left,this.params.center&&(this.position.left=this.position.left-this.msgbox.outerWidth()/2+i.outerWidth()/2);break;case"left":this.position.top=i.offset().top,this.position.left=i.offset().left-this.msgbox.outerWidth()-this.params.margin;break;case"right":this.position.top=i.offset().top,this.position.left=i.offset().left+i.outerWidth()+this.params.margin}if(!this.checkBound(t)){if(e!==!0)return this._pos(this.reverseMap[t],!0);this.setBound("down"),this.setBound("left"),this.position.top-=10,this.position.left+=10}return this.resetBound(),this.position},resetBound:function(t){if(this.params.bound||t===!0)for(var e=["up","down","left","right"],i=0;i<e.length;i++){var o=e[i];this.checkBound(o)||this.setBound(o)}},checkBound:function(t){switch(t){case"up":return this.position.top>=$(window).scrollTop();case"down":return this.position.top+this.msgbox.outerHeight()<=$(window).height()+$(window).scrollTop();case"left":return this.position.left>=$(window).scrollLeft();case"right":return this.position.left+this.msgbox.outerWidth()<=$(window).width()+$(window).scrollLeft();default:return!0}},setBound:function(t){switch(t){case"up":this.position.top=$(window).scrollTop();break;case"down":this.position.top=$(window).height()+$(window).scrollTop()-this.msgbox.outerHeight();break;case"left":this.position.left=$(window).scrollLeft();break;case"right":this.position.left=$(window).width()+$(window).scrollLeft()-this.msgbox.outerWidth()}}},t.exports=o},function(t,e,i){function o(){var t=$.ajax;$.ajax=function(e,i){return"object"==typeof e&&(i=e,e=void 0),"post"!=i.type&&"POST"!=i.type||!i.data||i.data.csrf||$.extend(i.data,{csrf:s.cookie&&s.cookie.get("bili_jct")}),t(e,i)}}function a(){$.fn.paging=function(t){var e=$.extend({pageCount:10,current:1,jump:!1,backFn:function(){}},t);p.init(this,e)}}var s=i(1),n=i(3),r=i(10),l=i(12),c=i(2),d=new c,p=i(11);i(5),function(t){function e(t,e,i,s,n,r){this.noface="//static.hdslb.com/images/member/noface.gif";var l={isLogin:!1,face:this.noface,vipStatus:0,vipType:0};if(this.upId="","object"==typeof e){var c=e;this.oid=c.oid,this.pageType=c.pageType;var s=c.userState;this.noLevelLimit=c.noLevelLimit,this.jumpId=c.jumpId,this.noPage=c.noPage,this.pageSize=c.pageSize||20,this.dynamicRepost=c.dynamicRepost,this.contentMaxLength=c.contentMaxLength||1e3,this.smallPager=c.smallPager,this.disableText=c.disableText}else this.oid=e,this.pageType=i,this.jumpId=n,this.mounted=r&&r.mounted||null,this.contentMaxLength=1e3;this.sort=2,this.loaded=!1,this.loading=!1,this.firstLoad=!1,this.emojiLoaded=!1,this.userStatus=l,this.fbData=[],this.events={},this.pageInfo={},this.foldedReply={},this.isViewHot=!1,this.readOnly=!1,this.blacklistCode=9,this.blacklist=0,this.assist=0,this._pos=-1,this.showBv=!1,this.currentPage=1,this.sendPosition=1,this.control={bg_text:"",child_input_text:"",input_disable:!1,root_input_text:"",web_selection:!1};var d=this;if(window.jQuery)o(),a(),this.start(t,s);else{var p=document.createElement("script");p.setAttribute("src","//s1.hdslb.com/bfs/static/jinkela/long/js/jquery/jquery3.3.1.min.js"),document.body.appendChild(p),p.onload=function(){a(),o(),d.start(t,s)}}return this}var i=10,c="//api.bilibili.com/x/v2/reply",p={reply:c,subReply:c+"/reply",report:c+"/report",blacklist:c+"/blacklist",add:c+"/add",emoji:c+"/v2/emojis",setTop:c+"/top",like:c+"/action",hate:c+"/hate",del:c+"/del",lotteryDel:c+"/lottery/del",jump:c+"/jump",folded:c+"/folded",replyFolded:c+"/reply/folded"},m={header:['<div class="comment-header clearfix">','<div class="tabs-order">','<ul class="clearfix">','<li class="default-sort" data-sort="0">全部评论</li>','<li data-sort="2" class="hot-sort  on"></li>','<li data-sort="0" class="new-sort">按时间排序</li>',"</ul>","</div>",'<div class="header-page paging-box"></div>',"</div>"].join("")},u={},f=window.localStorage&&window.localStorage.getItem,h="commentNotice";e.prototype.on=function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)},e.prototype.trigger=function(t){if(this.events[t]){for(var e=[],i=this,o=1;o<arguments.length;o++)e.push(arguments[o]);this.events[t].forEach(function(t){t.apply(i,e)})}},e.prototype.quickLogin=function(){s.browser.version.mobile?location.href="//passport.bilibili.com/login":window.biliQuickLogin?window.biliQuickLogin(function(t){window.location.reload()}):$.getScript("https://static-s.bilibili.com/account/bili_quick_login.js",function(){window.biliQuickLogin(function(t){window.location.reload()})})},e.prototype.start=function(t,e){var i=this,o={isLogin:!1,face:this.noface,vipStatus:0,vipType:0};this.$root=$(t),this.$root.length&&(window.reportObserver&&(reportObserver.scrollTracker?(reportObserver.scrollTracker.scrollReportOffset=1,reportObserver.scrollTracker.customReport(i.$root[0],".list-item","replyCardShow",{type:i.pageType,oid:i.oid,page:function(){return i.currentPage},ordering:function(){return 2===i.sort?"heat":"time"},rpid:function(t){return $(t).data("id")}})):"function"==typeof reportObserver.importTracker&&(reportObserver.importTracker("scroll"),window.onScrollTrackerLoaded=function(){reportObserver.scrollTracker.scrollReportOffset=1,reportObserver.scrollTracker.customReport(i.$root[0],".list-item","replyCardShow",{type:i.pageType,oid:i.oid,page:function(){return i.currentPage},ordering:function(){return 2===i.sort?"heat":"time"},rpid:function(t){return $(t).data("id")}})})),this._fixRootPosition(),this.userCard=new l(this.userStatus),this._registerEvent(),e?(this.userStatus=$.extend({},o,e),this.init()):$.ajax({url:"//api.bilibili.com/x/web-interface/nav",type:"GET",dataType:"jsonp",data:{jsonp:"jsonp"},xhrFields:{withCredentials:!0}}).done(function(t){t&&0==t.code&&(i.userStatus=$.extend({},o,t.data))}).always(function(){i.init()}))},e.prototype.init=function(t){t&&(this.userStatus=$.extend({},defaultStatus,t));try{var e=['<div class="bb-comment '+(s.browser.version.mobile?"bb-comment-h5":"")+'">','<div class="reply-notice"></div>',m.header,'<div class="comment-list '+(this.pageSize?"has-limit":"")+'"></div>','<div class="bottom-page '+(s.browser.version.mobile?"paging-box":"paging-box-big")+'"></div>',"</div>"].join("");this.$root.html(e),this._getEmoji(),this.userCard.reset(this.userStatus)}catch(t){window.console&&window.console.log("[comment]",t)}},e.prototype._fixRootPosition=function(){"static"==this.$root.css("position")&&this.$root.css({position:"relative"})},e.prototype._fixEmojiPosition=function(){if(!s.browser.version.mobile){var t;t=$(".comment-fold-bilibili").length>0?$(".comment-fold-bilibili .reply-item"):this.$root.find(".reply-box .reply-item"),t.each(function(t,e){var i=$(e).find(".reply-face"),o=$(e).find(".user"),a=$(e).find(".name");if(i&&o&&a){var s=a.offset().top-o.offset().top;s>10?i.css("top","32px"):i.css("top","0")}})}},e.prototype._getEmoji=function(){var t=this;t.emojiLoaded=!0,$.ajax({url:p.emoji,type:"GET",dataType:"jsonp",data:{jsonp:"jsonp"},cache:!0,jsonpCallback:"emoji"}).done(function(e){if(e&&e.data&&0===e.code){var i=e.data.vip,o=e.data.free||[],a=e.data.mapping||[];t._mkEmojiMap(i),t._mkEmojiMap(o);for(var s in a)u[s]=u[a[s]];t.edata={vip:i,free:o},t._showLoading("<span>loading...</span>"),t.jumpId?t.jumpToReply(t.jumpId):t._isInView(t.$root)&&t.loadPage(1),t.trigger("emojiLoaded")}}).fail(function(){t.emojiLoaded=!1,t.loaded||t._showLoading('<span>加载失败，<a class="reload-comment">点击重试</a></span>')})},e.prototype._mkEmojiMap=function(t){for(var e=0;e<t.length;e++)for(var i=0;i<t[e].emojis.length;i++){var o=t[e].emojis[i].name,a=s.trimHttp(t[e].emojis[i].url),n=t[e].emojis[i].size,r={l:50,s:50},l='<img src="'+s.trimHttp(s.webp(a,{w:r[n],h:r[n]}))+'"'+("s"===n?' class="small"':"")+' alt="'+(o.split("_")[1]||"").slice(0,-1)+'">';u[o]=l}},e.prototype._renderNotice=function(t){if(t){var e="",i=f?+window.localStorage.getItem(h):0;if(t.id>i){var o=t.link;o&&o.indexOf("__MID__")!==-1&&o.indexOf("__REQUESTID__")!==-1&&this.userStatus.mid?t.link=o.replace("__MID__",this.userStatus.mid||"__MID__").replace("__REQUESTID__",t.id||"__REQUESTID__"):t.link=o,e+='<div class="notice-item" data-id="'+t.id+'"><i class="icon-close-notice"></i><i class="icon-notice"></i><a href="'+t.link+'" target="_blank">'+t.content+"</a></div>"}this.$root.find(".reply-notice").html(e)}},e.prototype._resolveEmoji=function(t){var e=new RegExp(/\[[^\]]+\]/g);return t.replace(e,function(t){return u[t]||t})},e.prototype._resolveUrl=function(t){var e=/((ht|f)tps?):\/\/([\w\-]+(\.[\w\-]+)*\/)*[\w\-]+(\.[\w\-]+)*\/?(\?([\w\-\.,@?^=%&:\/~\+#]*)+)?/gi,i=t.match(e);return i&&i.length>0?(i.forEach(function(e){e.indexOf("bilibili.")>-1&&(t=t.replace(e,'<a href="'+e+'" target="_blank">'+e+"</a>"))}),t):t},e.prototype._resolveSeek=function(t){var e=this;if(1===this.pageType){var i=/(\d+\#)?(\d+\:){1,2}\d\d/g,o=t.match(i);o&&o.forEach(function(i){if(i.indexOf("#")>0)var o=parseInt(i.split("#")[0]),a=i.split("#")[1];else var o=-1,a=i;if(e._timeStrToNumber(a)){var s=e._timeStrToNumber(a);t=t.replace(i,'<a class="video-seek" data-p="'+o+'" data-time="'+s+'">'+i+"</a>")}})}return t},e.prototype._resolveVote=function(t,e){return e.vote?t.replace(/\{vote:.*}/,'<a class="vote-link" data-id="'+e.vote.id+'" data-name="'+s.unhtml(e.vote.title)+'"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuWbvuWxgl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMjggMjkiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDI4IDI5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+Cjx0aXRsZT5Hcm91cCAyPC90aXRsZT4KPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CjxnIGlkPSJQYWdlLTEiIHN0eWxlPSJmaWxsOiMwMEExRDYiPgoJPGcgaWQ9IuWwgemdoiI+CgkJPGcgaWQ9Ikdyb3VwLTIiPgoJCQk8ZyBpZD0iUmVjdGFuZ2xlLTUiPgoJCQkJPHBhdGggZD0iTTMuMywyOC4zQzEuNSwyOC4zLDAsMjYuOSwwLDI1VjEwLjFjMC0xLjgsMS41LTMuMywzLjMtMy4zczMuMywxLjUsMy4zLDMuM1YyNUM2LjcsMjYuOSw1LjIsMjguMywzLjMsMjguM3ogTTMuMyw4CgkJCQkJYy0xLjIsMC0yLjEsMS0yLjEsMi4xVjI1YzAsMS4yLDEsMi4xLDIuMSwyLjFzMi4xLTEsMi4xLTIuMVYxMC4xQzUuNSw4LjksNC41LDgsMy4zLDh6Ii8+CgkJCTwvZz4KCQkJPGcgaWQ9IlJlY3RhbmdsZS01XzFfIj4KCQkJCTxwYXRoIGQ9Ik0xNCwyOC40Yy0xLjgsMC0zLjMtMS41LTMuMy0zLjNWMy4zQzEwLjcsMS41LDEyLjIsMCwxNCwwczMuMywxLjUsMy4zLDMuM1YyNUMxNy4zLDI2LjksMTUuOCwyOC40LDE0LDI4LjR6IE0xNCwxLjIKCQkJCQljLTEuMiwwLTIuMSwxLTIuMSwyLjFWMjVjMCwxLjIsMSwyLjEsMi4xLDIuMWMxLjIsMCwyLjEtMSwyLjEtMi4xVjMuM0MxNi4xLDIuMiwxNS4yLDEuMiwxNCwxLjJ6Ii8+CgkJCTwvZz4KCQkJPGcgaWQ9IlJlY3RhbmdsZS01XzJfIj4KCQkJCTxwYXRoIGQ9Ik0yNC43LDI4LjRjLTEuOCwwLTMuMy0xLjUtMy4zLTMuM3YtNi44YzAtMS44LDEuNS0zLjMsMy4zLTMuM3MzLjMsMS41LDMuMywzLjNWMjVDMjgsMjYuOSwyNi41LDI4LjQsMjQuNywyOC40egoJCQkJCSBNMjQuNywxNi4xYy0xLjIsMC0yLjEsMS0yLjEsMi4xVjI1YzAsMS4yLDEsMi4xLDIuMSwyLjFzMi4xLTEsMi4xLTIuMXYtNi44QzI2LjgsMTcsMjUuOCwxNi4xLDI0LjcsMTYuMXoiLz4KCQkJPC9nPgoJCTwvZz4KCTwvZz4KPC9nPgo8L3N2Zz4K" alt="" />'+s.unhtml(e.vote.title)+"</a>"):t},e.prototype._resolveLottery=function(t,e){return e.lottery?t.replace(/\{lottery:.*}/,'<a class="lottery-link" data-id="'+e.lottery.lottery_id+'"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAApVJREFUSA3tVEtoE1EUvfclE39gW7uypYKfih9UmkR3ol10Iy6aRItaUbppQSSpLhRdBTciuEhKcVFEdCNobJNuuhTduUhiKEIVUQJ+aqmgJbTWOpnrGduZxsnHhauKD4b37jn3vvPufW8u0UofXCuB7oHX62dlpoeFmxWrJ8ORtrHjD9+t0Senzwob2xSpZyNh76Nae1QVCAxONIo+l2aSWSF+QSRHyMV32KB2EVrLTGlgHeDGUhHfmWoiqhpBxtxFbPLJ3eTbl+r3nVBuOkwGhUVkXX3dhj3JiO+k0jwHEN8VjD3fX22fGgLSSiJPE11cNINHzvuzOPE3xfTqbs/meRMbPrf3LXzyooztpl1pVBVg5rQQdZ66Nd5gBTKxISi+ZR8byBxEllsUS8bCnLN9B9FoVI03HD0kzE2mEwitKHQZd7AJ5nt8gstuFaYfWOYh7oFPC7FKwmfUjFE4gCryROJCW860zWELBOO5dqHiAwSPmlst0rAIL4ikHgBA2YksFsC9gZDOBk8B/WL5Yu3BA+jWlGpKhL3TJu62SEg3o9qpZL+/18KccyCWvgfJr/CJODnLho9fV8os6+8CqOxnnLIjEM9eR8oV7wYvyAuf78F45oa1YemMrBAqW1nTCxZuZ+DeuPqx/nE+QWJEcIsuuP56PZbj0qyZRQO/y4FjX9KU8BSzujTS55108rYdiGfyoVg2ZAMlC7NE+OIlkL3sHEjfBHffBpYWFUvhdPob+7/AH6u38ktk/wfLuUrBUOQNDeZeLmOLK6Oo16GNKHC7K3A70Mc+OPFyAaFr6Dm3i7p+1em8aKNj6frpco7zmkuuOHG72ZUSaAncN5QpE1/wNLqmCrq0rJqxW7YVN9TnR5f9F8dPt6z3H8GtPW0AAAAASUVORK5CYII=" alt="" />评论抽奖</a>'):t},e.prototype._resolveAt=function(t,e){var i=/<a(.*)>(.*)<\/a>/.test(t);return i?t.replace(/@[^\s]+/g,function(t){return e[t.trim().substring(1)]||t}).replace(/\n/g,"<br />"):t.replace(/@[^\s]+/g,function(t){return e[t.trim().substring(1)]||t}).replace(/\n/g,"<br />").replace(/av([0-9]+)/gi,'<a href="//www.bilibili.com/video/av$1/" target="_blank" data-view="$1">av$1</a>').replace(/cv([0-9]+)/gi,'<a href="//www.bilibili.com/read/cv$1/" target="_blank" data-view="$1">cv$1</a>').replace(/(bv1)(\w{9})/gi,this.showBv?'<a href="//www.bilibili.com/video/bv1$2/" target="_blank">$1$2</a>':"$1$2")},e.prototype._timeStrToNumber=function(t){var e=t.split(":");if(3===e.length&&2===e[1].length&&2===e[2].length){var i=parseInt(e[0]),o=parseInt(e[1]),a=parseInt(e[2]);if(o>=0&&o<60&&a>=0&&a<60)return a+60*o+3600*i}if(2===e.length&&2===e[1].length){var o=parseInt(e[0]),a=parseInt(e[1]);if(a>=0&&a<60)return a+60*o}},e.prototype._formateMemberMap=function(t){for(var e,i={},o=0,a=t.length;o<a;++o)e=t[o],i[e.uname]='<a href="//space.bilibili.com/'+e.mid+'" target="_blank" data-usercard-mid="'+e.mid+'">@'+s.unhtml(e.uname)+" </a>";return i},e.prototype._createReplyBox=function(t){t=t||{};var e="",i="",o="",a=this.control.root_input_text||"请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。";this.userStatus.isLogin?t.forbid||this.control.input_disable?(i=this.control.root_input_text||"当前稿件评论功能已关闭",o=this.control.child_input_text||"当前稿件评论功能已关闭",e="no-login"):this.disableText&&(i=this.disableText,e="no-login"):(i='请先<a class="b-btn btn-open-mini-Login">登录</a>后发表评论 (・ω・)',o='请先<a class="b-btn btn-open-mini-Login">登录</a>后发表评论 (・ω・)',e="no-login");var n='<div class="dynamic-repost"><label><input type="checkbox" class="dynamic-repost-checkbox" /><span>同时转发到我的动态</span></label></div>';return['<div class="comment-send '+e+'">','<div class="user-face">','<img class="user-head" src="'+s.trimHttp(s.webp(this.userStatus.face,{w:52,h:52}))+'" />',"</div>",'<div class="textarea-container">',i?'<div class="baffle-wrap"><div class="baffle">'+(t.isSub?o:i)+"</div></div>":"",'<i class="ipt-arrow"></i>','<textarea cols="80" name="msg" rows="5" placeholder="'+a+'" class="ipt-txt"></textarea>','<button type="submit" class="comment-submit" '+(e?'disabled="disabled"':"")+">发表评论</button>","</div>",'<div class="comment-emoji">','<i class="face"></i>','<span class="text">表情</span>',"</div>",!t.isSub&&this.dynamicRepost?n:"","</div>"].join("")},e.prototype.loadPage=function(t,e){var i=this;i.loading=!0,e&&$(window).scrollTop(i.$root.offset().top),i.emoji||(i.emoji=new r(i.$root,i.userStatus.vipStatus,i.edata)),this._getReplyByPage(t).done(function(e){if(i._hideLoading(),i.loaded=!0,e&&0===e.code){if(e.data){i.mode=e.data.mode,i.blacklist=e.data.blacklist||0,i.assist=e.data.assist||0,i.pageInfo=e.data.page||{},i.readOnly=e.data.config.read_only,i.folder=e.data.folder||{},i.showBv=e.data.show_bvid||!1;var o=i.pageInfo.num*i.pageInfo.size>=i.pageInfo.count,a=e.data.control;a&&(i.control.bg_text=a.bg_text,i.control.child_input_text=a.child_input_text,i.control.input_disable=a.input_disable,i.control.root_input_text=a.root_input_text,i.control.web_selection=a.web_selection),i._renderTabs(e),i._renderNotice(e.data.notice),i._updateReplyListByData(e.data,t,o),i._renderTopPagination(i.pageInfo),i._renderBottomPagination(i.pageInfo),i._fixEmojiPosition(),$(".common .b-head .results").html(e.data.page.acount||0).show(),$(".common .b-head .del-log").remove(),i.$root.find(".bb-comment > .comment-send").remove(),$(i._createReplyBox()).insertBefore(i.$root.find(".comment-list")),i.trigger("pageLoaded",o,e.data)}}else 12002==e.code&&(i.$root.find(".bb-comment > .comment-send").remove(),$(i._createReplyBox({forbid:!0})).insertBefore(i.$root.find(".comment-list")))}).fail(function(){i.loaded||i._showLoading('<span>加载失败，<a class="reload-comment">点击重试</a></span>')}).always(function(){i.loading=!1})},e.prototype._renderTabs=function(t){if(!this.firstLoad){this.firstLoad=!0,s.customReport("replyShow",{ordering:3===this.mode?"heat":"time",type:this.pageType,oid:this.oid});var e=this.$root.find(".comment-header .tabs-order .default-sort"),i=this.$root.find(".comment-header .tabs-order .new-sort"),o=this.$root.find(".comment-header .tabs-order .hot-sort");if(this.control.web_selection)return void o.html("精选评论");if(2===this.mode)return o.html("按热度排序"),e.hide().removeClass("on"),i.show().addClass("on"),o.show().removeClass("on"),this.sort=0,void(this.jumpId||this.loadPage(1));if(3===this.mode)return o.html("按热度排序"),e.hide().removeClass("on"),i.show(),void o.show().addClass("on");t.data.page&&t.data.page.count>=20||t.data.hots||2===this.sort?o.show():o.hide(),t.data.hots?this.isViewHot=!0:this.isViewHot=!1}},e.prototype._updateReplyListByData=function(t,e,i){var o=[],a=-1,s=this;s.upId=t.upper&&t.upper.mid,s.hasUpTop=t.upper&&t.upper.top,t.lottery_card&&(t.lottery_card.isUpTop=!0,o.push(t.lottery_card)),t.top&&1===s.pageInfo.num&&(t.top.isTop=!0,o.push(t.top)),t.upper&&t.upper.top&&1===s.pageInfo.num&&(t.upper.top.isUpTop=!0,o.push(t.upper.top)),t.upper&&t.upper.vote&&1===s.pageInfo.num&&(t.upper.vote.isUpTop=!0,o.push(t.upper.vote)),
1===e&&0===s.sort&&2!==s.mode&&3!==s.mode&&(s.isViewHot&&(o=o.concat(t.hots||[])),a=t.hots&&t.hots.length>0?o.length:-1,s._pos=a);var n;n=t.replies instanceof Array?o.length>0?s._uniq(o.concat(t.replies)):o.concat(t.replies):o.length>0?s._uniq(o):o,this.noPage&&this.pageSize&&(n=n.slice(0,this.pageSize)),s._renderReplyList(n,a,i)},e.prototype._uniq=function(t){var e={};return t.filter(function(t){return!e.hasOwnProperty(t.rpid)&&(e[t.rpid]=!0)})},e.prototype._renderTopPagination=function(t){if(!this.noPage){var e=this,i=Math.ceil(t.count/t.size);i>1?this.$root.find(".header-page").paging({pageCount:i,current:t.num,backFn:function(t){e.$root.trigger("replyPageChange",{p:t}),e.currentPage=t,s.videoReport("playpage_comment_pageclick1")}}):this.$root.find(".header-page").html("")}},e.prototype._renderBottomPagination=function(t){if(this.noPage){var e=t.count<=this.pageSize,i="";return i=e?"没有更多了～":'<a class="more-link" href="javascript:">查看更多评论</a>',void this.$root.find(".bottom-page").addClass("center").html(i)}var o=this,a=Math.ceil(t.count/t.size);a>1?this.$root.find(".bottom-page").paging({pageCount:a,current:t.num,jump:!s.browser.version.mobile,smallSize:this.smallPager,backFn:function(t){o.$root.trigger("replyPageChange",{p:t,isBottom:!0}),o.currentPage=t,s.videoReport("playpage_comment_pageclick2")}}):this.$root.find(".bottom-page").html("")},e.prototype._renderReplyList=function(t,e,i){var o="";if(t){if(this.fbData=t,0!==t.length||this.noPage){this.$root.find(".no-more-reply").remove();for(var a=0,s=t.length;a<s;++a){var n=t[a];n&&((a<e||n.isUpTop||n.isTop)&&(n.isHot=!0),o+=this._createReplyItem(n,a,e),e&&a===e-1&&this.isViewHot&&e<t.length&&(o+='<div class="hot-line"><span>以上为热门评论，<a class="more-hot">查看更多</a></span></div>'))}i&&this.folder.has_folded&&(o+='<div class="reply-fold-tip"><a class="view-fold">查看被折叠的评论</a><a href="'+this.folder.rule+'" class="fold-rule" target="_blank">（折叠规则）</a></div>')}else o+='<div class="no-more-reply">'+(this.control.bg_text||"没有更多信息")+"</div>";this.$root.find(".comment-list").html(o),this.mounted&&this.mounted(t)}},e.prototype._createReplyItem=function(t,e,i){return t.folder&&t.folder.has_folded&&(this.foldedReply[t.rpid]=t),['<div class="list-item reply-wrap '+(t.isTop||t.isUpTop?"is-top":"")+'" data-id="'+t.rpid+(t.lottery_id?'" data-lottery-id='+t.lottery_id:'"')+' data-index="'+e+'">',this._createUserFace(t),this._createListCon(t,e,i),"</div>"].join("")},e.prototype._createTopFoldedReplyItem=function(t){return['<div class="list-item reply-wrap top-fold-reply" data-id="'+t.rpid+'">',this._createUserFace(t),this._createTopFoldedListCon(t),"</div>"].join("")},e.prototype._createSubFoldedReplyItem=function(t,e){return['<div class="list-item reply-wrap '+(e?"no-border":"")+'" data-id="'+t.rpid+'">',this._createUserFace(t),this._createSubFoldedListCon(t),"</div>"].join("")},e.prototype._createLegalizeIcon=function(t){var e="";return t&&0==t.type?e='<div class="legalize p-auth" title="个人认证"></div>':t&&1==t.type&&(e='<div class="legalize o-auth" title="企业/团体认证"></div>'),e},e.prototype._createUserFace=function(t){var e='<div class="user-face"><img src="'+this.noface+'"></div>',i=['<div class="user-face">','<a href="//space.bilibili.com/'+t.mid+'" target="_blank" data-usercard-mid="'+t.mid+'">','<img src="'+s.trimHttp(s.webp(t.member.avatar,s.browser.version.mobile?{w:45,h:45}:{w:52,h:52}))+'" alt="">',"</a>",t.member.pendant&&t.member.pendant.image?'<a href="//space.bilibili.com/'+t.mid+'" class="pendant" data-usercard-mid="'+t.mid+'" target="_blank"><img src="'+s.trimHttp(s.webp(t.member.pendant.image,s.browser.version.mobile?{w:71,h:71}:{w:86,h:86}))+'"></a>':"",this._createLegalizeIcon(t.member.official_verify),t.isHot?this._createFollowButton(t.member,t.rpid):"","</div>"].join("");return t.state===this.blacklistCode?e:i},e.prototype._createFollowButton=function(t,e){function i(t){$.ajax({url:"//api.bilibili.com/x/relation",data:{fid:t.mid,jsonp:"jsonp"},dataType:"jsonp"}).done(function(e){if(e&&0===e.code){var i=$('.follow-btn[data-mid="'+t.mid+'"]'),o=1===e.data.attribute||2===e.data.attribute||6===e.data.attribute,a=1===e.data.attribute;o&&i.addClass("followed").text("已关注"),a&&i.attr("quiet",!0)}})}var o=['<div class="hot-follow">','<button class="follow-btn" data-mid="'+t.mid+'" data-uname="'+s.unhtml(t.uname)+'" data-rpid="'+e+'">关注</button>',"</div>"].join("");return this.userStatus.isLogin&&i(t),o},e.prototype._createListCon=function(t,e,i){var o=this._parentBlacklistDom(t,e,i),a=['<div class="con '+(i==e?"no-border":"")+'">','<div class="user">'+this._identity(t.mid,t.assist,t.member.fans_detail),'<a data-usercard-mid="'+t.mid+'" href="//space.bilibili.com/'+t.mid+'" target="_blank" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus,t.member.vip.themeType)+'">'+s.unhtml(t.member.uname)+'</a><a class="level-link" href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>'+this._createNameplate(t.member.nameplate)+"</div>",this._createMsgContent(t),'<div class="info">',t.floor?'<span class="floor">#'+t.floor+"</span>":"",this._createPlatformDom(t.content.plat),'<span class="time">'+this._formateTime(t.ctime)+"</span>",t.lottery_id?"":'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",t.lottery_id?"":'<span class="hate '+(2==t.action?"hated":"")+'"><i></i></span>',t.lottery_id?"":this._createReplyBtn(t.rcount),t.lottery_id&&t.mid!==this.userStatus.mid?"":'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(t)?'<li class="set-top">'+(t.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)&&!t.isTop?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>",this._createLotteryContent(t.content),this._createVoteContent(t.content),"</div>",'<div class="reply-box">',this._createSubReplyList(t.replies,t.rcount,!1,t.rpid,t.folder&&t.folder.has_folded),"</div>",'<div class="paging-box">',"</div>","</div>"].join("");return s.browser.version.mobile&&(a=['<div class="con '+(i==e?"no-border":"")+'">','<div class="user">'+this._identity(t.mid,t.assist,t.member.fans_detail),'<a data-usercard-mid="'+t.mid+'" href="//space.bilibili.com/'+t.mid+'" target="_blank" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus,t.member.vip.themeType)+'">'+s.unhtml(t.member.uname)+'</a><a class="level-link" href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>'+this._createNameplate(t.member.nameplate)+'<div class="right">',t.floor?'<span class="floor">#'+t.floor+"</span>":"",'<span class="time">'+this._formateMobileTime(t.ctime)+"</span></div>","</div>",this._createMsgContent(t),this._createVoteContent(t.content),'<div class="info">',this._createPlatformDom(t.content.plat),'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="hate '+(2==t.action?"hated":"")+'"><i></i></span>',this._createReplyBtn(t.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(t)?'<li class="set-top">'+(t.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)&&!t.isTop?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>",'<div class="reply-box">',this._createSubReplyList(t.replies,t.rcount,!1,t.rpid,t.folder&&t.folder.has_folded),"</div>",'<div class="paging-box">',"</div>","</div>"].join("")),t.state===this.blacklistCode?o:a},e.prototype._createSubFoldedListCon=function(t){var e=this._parentBlacklistDom(t,0),i=['<div class="con">','<div class="user">'+this._identity(t.mid,t.assist,t.member.fans_detail),'<a data-usercard-mid="'+t.mid+'" href="//space.bilibili.com/'+t.mid+'" target="_blank" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus,t.member.vip.themeType)+'">'+s.unhtml(t.member.uname)+'</a><a class="level-link" href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>'+this._createNameplate(t.member.nameplate),"</div>",this._createMsgContent(t),'<div class="info">','<span class="time">'+this._formateTime(t.ctime)+"</span>",'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",this._createReplyBtn(t.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(t)?'<li class="set-top">'+(t.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)&&!t.isTop?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>"].join("");return s.browser.version.mobile&&(i=['<div class="con">','<div class="user">'+this._identity(t.mid,t.assist,t.member.fans_detail),'<a data-usercard-mid="'+t.mid+'" href="//space.bilibili.com/'+t.mid+'" target="_blank" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus,t.member.vip.themeType)+'">'+s.unhtml(t.member.uname)+'</a><a class="level-link" href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>'+this._createNameplate(t.member.nameplate),'<div class="right">','<span class="time">'+this._formateMobileTime(t.ctime)+"</span></div>","</div>",this._createMsgContent(t),'<div class="info">',this._createPlatformDom(t.content.plat),'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",this._createReplyBtn(t.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(t)?'<li class="set-top">'+(t.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)&&!t.isTop?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>"].join("")),t.state===this.blacklistCode?e:i},e.prototype._createTopFoldedListCon=function(t){var e=this._parentBlacklistDom(t,0),i=['<div class="con">','<div class="user">'+this._identity(t.mid,t.assist,t.member.fans_detail),'<a data-usercard-mid="'+t.mid+'" href="//space.bilibili.com/'+t.mid+'" target="_blank" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus,t.member.vip.themeType)+'">'+s.unhtml(t.member.uname)+'</a><a class="level-link" href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>'+this._createNameplate(t.member.nameplate),"</div>",this._createMsgContent(t),'<div class="info">',t.floor?'<span class="floor">#'+t.floor+"</span>":"",this._createPlatformDom(t.content.plat),'<span class="time">'+this._formateTime(t.ctime)+"</span>",'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="hate '+(2==t.action?"hated":"")+'"><i></i></span>',this._createReplyBtn(t.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(t)?'<li class="set-top">'+(t.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)&&!t.isTop?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>"].join("");return s.browser.version.mobile&&(i=['<div class="con">','<div class="user">'+this._identity(t.mid,t.assist,t.member.fans_detail),'<a data-usercard-mid="'+t.mid+'" href="//space.bilibili.com/'+t.mid+'" target="_blank" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus,t.member.vip.themeType)+'">'+s.unhtml(t.member.uname)+'</a><a class="level-link" href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>'+this._createNameplate(t.member.nameplate),'<div class="right">',t.floor?'<span class="floor">#'+t.floor+"</span>":"",'<span class="time">'+this._formateMobileTime(t.ctime)+"</span></div>","</div>",this._createMsgContent(t),'<div class="info">',this._createPlatformDom(t.content.plat),'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="hate '+(2==t.action?"hated":"")+'"><i></i></span>',this._createReplyBtn(t.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(t)?'<li class="set-top">'+(t.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)&&!t.isTop?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>"].join("")),t.state===this.blacklistCode?e:i},e.prototype._createMsgContent=function(t){var e="";if([3,4].indexOf(t.state)===-1||t.content.lottery){var i=t.content.message.replace(/&amp;/g,"&"),o=this._resolveUrl(i),a=this._formateMemberMap(t.content.members||[]),s=this._resolveAt(o,a),n=this._resolveEmoji(s,t.content),r=this._resolveSeek(n),l=this._resolveVote(r,t.content),c=this._resolveLottery(l,t.content);e='<p class="text">'+(t.isTop||t.isUpTop?'<span class="stick">置顶</span>':"")+c+"</p>"}else e='<p><a href="javascript:;">***</a></p>';return e},e.prototype._createVoteContent=function(t){if(t.vote&&t.vote.id&&!t.lottery){t.vote.title=s.unhtml(t.vote.title);var e=['<div class="vote-container" data-id="'+t.vote.id+'" data-name="'+t.vote.title+'">','<div class="image-area">','<div class="share-img"></div>',"</div>",'<div class="text-area">','<div class="text-content">'+t.vote.title+"</div>",'<div class="text-desc">'+t.vote.cnt+"人参与</div>",'<div class="vote-btn-box">','<div class="vote-btn">投票</div>',"</div>","</div>","</div>"].join("");return e}return""},e.prototype._createLotteryContent=function(t){if(t.lottery&&t.lottery.lottery_id){t.lottery.title=s.unhtml(t.lottery.title);var e;(new Date).getTime(),e=2===t.lottery.lottery_status?"活动已结束":s.formatLotteryTime(t.lottery.lottery_time);var i=['<div class="lottery-container" data-id="'+t.lottery.lottery_id+'">','<div class="image-area">','<div class="share-img"></div>',"</div>",'<div class="text-area">','<div class="text-content">评论抽奖</div>','<div class="text-desc">'+e+"</div>",2===t.lottery.lottery_status?'<div class="lottery-btn-box"><div class="lottery-btn">查看结果</div></div>':"","</div>","</div>"].join("");return i}return""},e.prototype._canSetTop=function(t){return!!this.userStatus.isLogin&&+this.upId===+this.userStatus.mid&&!t.lottery_id&&!t.isTop},e.prototype._canReport=function(t){return+t!==+this.userStatus.mid},e.prototype._canBlackList=function(t){return+t!==+this.userStatus.mid},e.prototype._identity=function(t,e,i){if(+this.upId===t)return'<span class="stick assist">UP</span>';if(e)return'<span class="stick assist">骑士</span>';if(i){var o=["#2EBDA7","#5896DE","#A068F1","#FF86B2","#F68D18"],a=o[Math.ceil(i.level/5)-1];return'<span class="stick true-love" style="border-color:'+a+";color:"+a+'">'+i.medal_name+'<span class="medal-level" style="border-color:'+a+'">'+i.level+"</span></span>"}return""},e.prototype._canDel=function(t){return!!this.userStatus.isLogin&&(+this.upId===+this.userStatus.mid||+this.userStatus.mid===+t||this.assist)},e.prototype._createReplyBtn=function(t){return t>0?'<span class="reply btn-hover btn-highlight">回复</span>':'<span class="reply btn-hover">回复</span>'},e.prototype._createNameplate=function(t){return t.image_small?'<div class="nameplate"><a class="nameplate-icon"'+(s.browser.version.mobile?"":'href="https://account.bilibili.com/site/nameplate.html" target="_blank"')+'><img src="'+s.trimHttp(s.webp(t.image_small,{w:32,h:32}))+'"></a><div class="nameplate-card"><i class="nameplate-arrow"></i><img class="nameplate-pic" src="'+s.trimHttp(s.webp(t.image,{w:62,h:62}))+'"><div class="nameplate-text"><p class="n-name">'+t.name+'</p><p class="n-title">'+t.condition+'</p><p class="n-type"><span>'+t.level+'</span><a href="https://account.bilibili.com/site/nameplate.html" target="_blank">查看全部>></a></p></div></div></div>':""},e.prototype._createPlatformDom=function(t){var e="";return 2===t?e="安卓客户端":3===t?e="iOS客户端":4===t&&(e="Windows Phone客户端"),e&&'<span class="plad">来自<a href="//app.bilibili.com/" target="_blank">'+e+"</a></span>"},e.prototype._checkId=function(t,e){for(var i=0,o=t.length;i<o;++i)if(+t[i].rpid===+e)return!0;return!1},e.prototype._createSubReplyList=function(t,e,i,o,a,s){var n="";if(!t||0===t.length)return n;for(var r=!!this.jumpId&&this._checkId(t,this.jumpId),l=i||r?t.length:Math.min(t.length,3),c=0;c<l;++c){var d=t[c],p=this._createSubReplyItem(d,c),m=this._subBlacklistDom(d);n+=d.state===this.blacklistCode?m:p}return(s||e<=3)&&a&&(n+='<div class="sub-reply-fold-tip"><a class="view-sub-fold" data-root="'+o+'">查看被折叠的回复</a><a href="'+this.folder.rule+'" class="fold-rule" target="_blank">（折叠规则）</a></div>'),!i&&!r&&e>3&&(n+='<div class="view-more">共<b>'+e+'</b>条回复, <a class="btn-more" data-pid="'+o+'" data-fold="'+a+'">点击查看</a></div>'),n},e.prototype._createSubReplyItem=function(t,e){var i=['<div class="reply-item reply-wrap" data-id="'+t.rpid+'" data-index="'+e+'">','<a href="//space.bilibili.com/'+t.mid+'" data-usercard-mid="'+t.mid+'" target="_blank" class="reply-face">','<img src="'+s.trimHttp(s.webp(t.member.avatar,{w:52,h:52}))+'" alt="">',"</a>",'<div class="reply-con">','<div class="user">','<a href="//space.bilibili.com/'+t.mid+'" target="_blank" data-usercard-mid="'+t.mid+'" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus,t.member.vip.themeType)+'">'+s.unhtml(t.member.uname)+"</a>",'<a class="level-link" href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>',this._createSubMsgContent(t),"</div>","</div>",'<div class="info">','<span class="time">'+this._formateTime(t.ctime)+"</span>",'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="hate '+(2==t.action?"hated":"")+'"><i></i></span>','<span class="reply btn-hover">回复</span>','<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul>'+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>"].join("");if(s.browser.version.mobile)var i=['<div class="reply-item reply-wrap" data-id="'+t.rpid+'" data-index="'+e+'">','<div class="reply-con">','<div class="user">','<a href="//space.bilibili.com/'+t.mid+'" target="_blank" data-usercard-mid="'+t.mid+'" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus,t.member.vip.themeType)+'">'+s.unhtml(t.member.uname)+"</a>",'<a class="level-link" href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i>','<div class="right"><span class="time">'+this._formateMobileTime(t.ctime)+"</span></div>","</a>",this._createSubMsgContent(t),"</div>",'<div class="info">','<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="reply btn-hover">回复</span>','<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul>'+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>","</div>"].join("");return i},e.prototype._createSubMsgContent=function(t){var e="";if(1===t.state)e='<a class="hidden-reply-toggle" href="javascript:;">[此楼层已被用户隐藏 点击查看]</a><div class="quote" style="display:none;">'+this._resolveAt(t.content.message,this._formateMemberMap(t.content.members||[]))+"</div>";else if([3,4].indexOf(t.state)!==-1)e='<a href="javascript:;">***</a>';else{var i=t.content.message.replace(/&amp;/g,"&");e='<span class="text-con">'+this._resolveEmoji(this._resolveAt(this._resolveUrl(i),this._formateMemberMap(t.content.members||[])))+"</span>"}return e},e.prototype._formateTime=function(t){if(!+t)return t;var e=Math.floor((new Date).getTime()/1e3),i=new Date;if(i.setHours(0),i.setMinutes(0),i.setSeconds(0),i=Math.floor(i.getTime()/1e3),t>i&&e-t>=0){if(e-t<=50){var o=10*Math.floor((e-t)%60/10);return(t>10?o:10)+"秒前"}return e-t<3600?Math.ceil((e-t)/60)+"分钟前":Math.ceil((e-t)/3600)+"小时前"}var a=new Date;a.setTime(1e3*t);var s=a.getMonth()+1,n=a.getDate(),r=a.getHours(),l=a.getMinutes();return s<10&&(s="0"+s),n<10&&(n="0"+n),r<10&&(r="0"+r),l<10&&(l="0"+l),a.getFullYear()+"-"+s+"-"+n+" "+r+":"+l},e.prototype._formateMobileTime=function(t){if(!+t)return t;var e=Math.floor((new Date).getTime()/1e3);if(e-t>=0){if(e-t<=50){var i=10*Math.floor((e-t)%60/10);return(t>10?i:10)+"秒前"}return e-t<3600?Math.ceil((e-t)/60)+"分钟前":e-t<86400?Math.ceil((e-t)/3600)+"小时前":e-t<2592e3?Math.ceil((e-t)/3600/24)+"天前":e-t<31536e3?Math.ceil((e-t)/3600/24/30)+"月前":Math.ceil((e-t)/3600/24/365)+"年前"}},e.prototype._getReplyByPage=function(t){var e=this;return $.ajax({url:p.reply,data:{jsonp:"jsonp",pn:t,type:e.pageType,oid:e.oid,sort:e.sort},dataType:"jsonp"})},e.prototype._getSubReplyByPage=function(t,e){var o=this;return $.ajax({url:p.subReply,data:{jsonp:"jsonp",pn:e,type:o.pageType,oid:o.oid,ps:i,root:t},dataType:"jsonp"})},e.prototype._getFoldedReply=function(t){var e={oid:this.oid,type:this.pageType,jsonp:"jsonp"};return t&&(e.next=t),$.ajax({url:p.folded,data:e,dataType:"jsonp"})},e.prototype._getSubFoldedReply=function(t,e){var i={oid:this.oid,type:this.pageType,root:t,jsonp:"jsonp"};return e&&(i.next=e),$.ajax({url:p.replyFolded,data:i,dataType:"jsonp"})},e.prototype._createVipClass=function(t,e,i){return 1===i&&2===t?"vip-green-name":2===t&&1===e?"vip-red-name":""},e.prototype._sendMsg=function(t,e,i){var o=this,a=$(t).find(".comment-submit"),s=$(t).find("textarea"),r=this.isSubReply,l=(new RegExp(/\[[^\]]+_[^\]]+\]/g),e.msg);if(l=l.replace(/(^\s*)|(\s*$)/g,""),0===l.length)return(new n).show(a,"你还没有评论！",2e3,"error"),s.focus().parent().addClass("error"),!1;s.parent().removeClass("error"),a.text("发送中").addClass("disabled"),o.timer=setTimeout(function(){clearTimeout(o.timer),a.text("发表评论").removeClass("disabled"),(new n).show(t,"当前网速不太给力哦，请尝试重新提交~",2e3,"info")},5e3);var c=String(e.msg).replace(/\　{5,}/g,"　　　").replace(/\n{3,}/g,"\n\n\n")||e.msg,d=(r?this.atMsg:"")+c,m={oid:this.oid,type:this.pageType,root:e.rid,parent:e.pid,message:d,plat:e.plat,code:e.code,jsonp:"jsonp"};$.ajax({url:p.add,type:"POST",data:m,dataType:"json",xhrFields:{withCredentials:!0},success:function(e){if(e&&0===e.code){if(s.val(""),i&&0===e.data.success_action&&i(e.data.rpid),(new n).show(a,e.data.success_toast||"发送成功",2e3),o._removeCaptcha(),o.dynamicRepost){var r=o.$root.find(".dynamic-repost-checkbox")[0].checked;r&&o.trigger("dynamicRepost",d,o.oid,o.userStatus.mid)}}else 12041===e.code?o._blackroomExamFB():61001===e.code||61002===e.code?$.getScript("//static.hdslb.com/common/js/identityDialog.js",function(){IdentityDialog(e.code,e.message)}):e&&(new n).show(a,e.message||"操作失败",2e3,"error");e&&e.data&&e.data.need_captcha?o._renderCaptcha(t,e.data.url):o._removeCaptcha(),o.trigger("commentSent",m,e),clearTimeout(o.timer),a.text("发表评论").removeClass("disabled")}})},e.prototype._renderCaptcha=function(t,e){var i='<div class="comment-captcha"><span>验证码：</span><input type="text" class="b-input" size="6" /><img src="'+s.trimHttp(e)+'"/></div>';t.find(".comment-captcha").remove(),t.append(i)},e.prototype._removeCaptcha=function(){$(".comment-captcha").remove()},e.prototype._reportFB=function(t,e,i,o){function a(t,a,s){var r=this,l={oid:e,type:i,rpid:o,reason:t,content:a,jsonp:"jsonp"};$.ajax({url:p.report,type:"post",data:l,xhrFields:{withCredentials:!0}}).done(function(t){0===t.code?((new n).show(s,"举报成功",1e3,"info"),$(".comment-report-bilibili-mask").remove()):12019==t.code?(new n).show(s,"举报过于频繁，请"+t.data.ttl+"秒后重试",1e3,"error"):(new n).show(s,t.message||"提交失败，请重试",1e3,"info"),r.trigger("report",l,t)})}var r=['<div class="comment-bilibili-mask comment-report-bilibili-mask" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-report-bilibili">','<div class="t">请选择举报理由<i class="btn-close"></i></div>','<div class="con">','<div class="reason-box"></div>','<div class="other">','<p class="btn-other"><input type="radio" name="reason" id="other" value="0" /><label for="other">其他</label></p>','<div class="ta"><textarea placeholder="自定义理由" value=""></textarea></div></div>','<div class="btn"><a class="btn-cancel">取消</a><a class="btn-submit">确定</a><div>',"</div></div></div>"].join("");$(".comment-report-bilibili-mask").remove(),$("body").append(r);for(var l=[{type:"违反法律法规",list:[{name:"违法违规",reason:9},{name:"色情",reason:2},{name:"低俗",reason:10},{name:"赌博诈骗",reason:12}]},{type:"侵犯个人权益",list:[{name:"人身攻击",reason:7},{name:"侵犯隐私",reason:15}]},{type:"有害社区环境",list:[{name:"垃圾广告",reason:1},{name:"引战",reason:4},{name:"剧透",reason:5},{name:"刷屏",reason:3},{name:"抢楼",reason:16},{name:"内容不相关",reason:8},{name:"青少年不良信息",reason:17}]}],c=$(".comment-report-bilibili .reason-box"),d="",m=0,u=0;u<l.length;u++){d+='<dl class="clearfix"><dt>'+l[u].type+"</dt>";for(var f=0;f<l[u].list.length;f++)d+='<dd><input type="radio" name="reason" id="r'+m+'" value="'+l[u].list[f].reason+'" /><label for="r'+m+'">'+l[u].list[f].name+"</label></dd>",m++;d+="</dl>"}return c.append(d),$(".comment-report-bilibili").off("click.comment-report-close").on("click.comment-report-close",".btn-close,.btn-cancel",function(t){$(".comment-report-bilibili-mask").remove()}),$(".comment-report-bilibili").off("click.comment-report-label").on("click.comment-report-label","label",function(t){"other"===$(this).attr("for")?$(".comment-report-bilibili").find(".ta").show(200):$(".comment-report-bilibili").find(".ta").hide(200)}),$(".comment-report-bilibili").off("click.comment-report-submit").on("click.comment-report-submit",".btn-submit",function(t){var e=$(".comment-report-bilibili").find('input[type="radio"]:checked').val(),i=$(".comment-report-bilibili").find("textarea").val();e?"0"==e?i?s.getByteLen(i)>=2&&s.getByteLen(i)<=200?a(e,i,$(this)):(new n).show($(this),"自定义举报内容长度为2-200字符",1e3,"error"):(new n).show($(this),"请完善举报理由",1e3,"error"):a(e,i,$(this)):(new n).show($(this),"请选择举报理由",1e3,"error")}),!1},e.prototype._voteFB=function(t,e,i){var o=['<div class="comment-bilibili-mask comment-vote-bilibili-mask" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-vote-bilibili">','<div class="t">'+i+'<i class="btn-close"></i></div>','<div class="con">','<div class="vote-iframe"><iframe src="//t.bilibili.com/h5/dynamic/vote#/result?vote_id='+e+'&from=comment&isWeb=true" frameborder="0"></iframe></div>',"</div></div></div>"].join("");$(".comment-vote-bilibili-mask").remove(),$("body").append(o),$(".comment-vote-bilibili").off("click.comment-vote-close").on("click.comment-vote-close",".btn-close,.btn-cancel",function(t){$(".comment-vote-bilibili-mask").remove()})},e.prototype._lotteryFB=function(t,e){var i=['<div class="comment-bilibili-mask comment-vote-bilibili-mask" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-vote-bilibili">','<div class="t">评论抽奖<i class="btn-close"></i></div>','<div class="con">','<div class="vote-iframe"><iframe src="//t.bilibili.com/lottery/h5/index/#/result?lottery_id='+e+'" frameborder="0"></iframe></div>',"</div></div></div>"].join("");$(".comment-vote-bilibili-mask").remove(),$("body").append(i),$(".comment-vote-bilibili").off("click.comment-vote-close").on("click.comment-vote-close",".btn-close,.btn-cancel",function(t){$(".comment-vote-bilibili-mask").remove()})},e.prototype._blackListFB=function(t,e,i,o,a){var s=this,r=['<div class="comment-bilibili-mask comment-bilibili-blacklist" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con">','<div class="t">确认拉黑该用户<i class="btn-close"></i></div>','<div class="con">','<div class="text">拉黑该用户之后，将自动解除关注关系，并禁止他关注我<br>以及与我互动。</div>','<div class="btn"><a class="btn-cancel">取消</a><a class="btn-submit">确定</a><div>',"</div></div></div>"].join("");$(".comment-bilibili-blacklist").remove(),$("body").append(r),$(".comment-bilibili-blacklist").off("click.comment-blacklist-close").on("click.comment-blacklist-close",".btn-close,.btn-cancel",function(t){$(".comment-bilibili-blacklist").remove()}),$(".comment-bilibili-blacklist").off("click.comment-blacklist-submit").on("click.comment-blacklist-submit",".btn-submit",function(e){var i=this;d.addBlacklist(o,function(e){if(0===e.code){var r="";if(a.hasClass("list-item")){var l=a.data("index"),c=s.fbData[l];r='<div class="user-face"><img src="'+s.noface+'"></div>'+s._parentBlacklistDom(c,l,s._pos),a.html(r)}if(a.hasClass("reply-item")){var l=a.parents(".list-item").data("index"),d=a.data("index"),c=s.fbData[l].replies[d];r=s._subBlacklistDom(c),$(r).insertAfter(a),a.remove()}(new n).show($(i),"加入黑名单成功",1e3,"info"),$(".comment-bilibili-blacklist").remove()}else(new n).show(t,"加入黑名单失败",1e3,"info"),$(".comment-bilibili-blacklist").remove();s.trigger("blackList",o,e)})})},e.prototype._blackroomExamFB=function(t,e,i,o,a){var s=['<div class="comment-bilibili-mask comment-bilibili-blackexam" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con">','<div class="t no-title"><i class="btn-close"></i></div>','<div class="con">','<div class="text">该账号处于封禁中，点击申请答题</div>','<div class="btn"><a class="btn-cancel">取消</a><a class="btn-submit" target="_blank" href="//www.bilibili.com/blackroom/releaseexame.html">去答题</a><div>',"</div></div></div>"].join("");$("body").append(s),$(".comment-bilibili-blackexam").off("click.comment-blackexam-close").on("click.comment-blackexam-close",".btn-close,.btn-cancel,.btn-submit",function(t){$(".comment-bilibili-blackexam").remove()})},e.prototype._foldFB=function(t){var e=this;this._getFoldedReply(this.foldedNext).then(function(i){if(0!==i.code)return void(new n).show(t,i.message,2e3,"error");var o=i.data;e.foldedNext=o.cursor.next,e.foldIsEnd=o.cursor.is_end;var a="";o.replies.forEach(function(t){a+=e._createReplyItem(t,0)});var r=['<div class="comment-bilibili-mask comment-bilibili-fold'+(s.browser.version.mobile?"-h5":"")+'" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-fold-bilibili">','<div class="t">查看评论<i class="btn-close"></i></div>','<div class="comment-area"><div class="comment-list">',a,"</div></div>","</div>","</div>"].join("");$("body").append(r).addClass("preventScroll"),e._registerEvent(".comment-bilibili-fold"),e.foldDialogIsOpen=!0,$(".comment-fold-bilibili").off("click.comment-fold-close").on("click.comment-fold-close",".btn-close",function(t){$(".comment-bilibili-fold").remove(),$("body").removeClass("preventScroll"),e.foldDialogIsOpen=!1,e.foldedNext=null}),e._fixEmojiPosition(),e._needLoadMoreFold()&&e._loadMoreFold(),
$(".comment-bilibili-fold .comment-area").off("scroll").on("scroll",function(){e._needLoadMoreFold()&&!e.isLoadingFold&&e._loadMoreFold()})})},e.prototype._subFoldFB=function(t,e){var i=this;this._getSubFoldedReply(e,this.subFoldedNext).then(function(o){if(0!==o.code)return void(new n).show(t,o.message,2e3,"error");var a=o.data;i.subFoldedNext=a.cursor.next,i.subFoldIsEnd=a.cursor.is_end;var r="";r+=i._createTopFoldedReplyItem(i.foldedReply[e]),r+='<p class="sub-fold-tip">被折叠评论</p>',a.replies.forEach(function(t,e){r+=i._createSubFoldedReplyItem(t,0===e)});var l=['<div class="comment-bilibili-mask comment-bilibili-fold comment-bilibili-sub-fold'+(s.browser.version.mobile?"-h5":"")+'" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-sub-fold-bilibili">','<div class="t">查看评论<i class="btn-close"></i></div>','<div class="comment-area"><div class="comment-list">',r,"</div></div>","</div>","</div>"].join("");$("body").append(l).addClass("preventScroll"),i._registerEvent(".comment-bilibili-fold"),i.subFoldDialogIsOpen=!0,$(".comment-sub-fold-bilibili").off("click.comment-sub-fold-close").on("click.comment-sub-fold-close",".btn-close",function(t){$(".comment-bilibili-sub-fold").remove(),$("body").removeClass("preventScroll"),i.subFoldDialogIsOpen=!1,i.subFoldedNext=null}),i._needLoadMoreSubFold()&&i._loadMoreSubFold(e),$(".comment-bilibili-fold .comment-area").off("scroll").on("scroll",function(){i._needLoadMoreSubFold()&&!i.isLoadingSubFold&&i._loadMoreSubFold(e)})})},e.prototype._needLoadMoreFold=function(){var t=$(".comment-fold-bilibili .comment-area"),e=$(".comment-fold-bilibili .comment-list"),i=t.height(),o=e.height(),a=t.scrollTop();return this.foldDialogIsOpen&&!this.foldIsEnd&&(o<=i+20||i+a+20>o)},e.prototype._loadMoreFold=function(){var t=this;t.isLoadingFold=!0,this._getFoldedReply(this.foldedNext).then(function(e){if(0===e.code){var i=e.data;t.foldedNext=i.cursor.next,t.foldIsEnd=i.cursor.is_end;var o="";i.replies.forEach(function(e){o=t._createReplyItem(e,0),$(".comment-fold-bilibili .comment-list").append(o)}),t.isLoadingFold=!1,t._fixEmojiPosition(),t._needLoadMoreFold()&&t._loadMoreFold()}}).fail(function(){t.isLoadingFold=!1})},e.prototype._needLoadMoreSubFold=function(){var t=$(".comment-sub-fold-bilibili .comment-area"),e=$(".comment-sub-fold-bilibili .comment-list"),i=t.height(),o=e.height(),a=t.scrollTop();return this.subFoldDialogIsOpen&&!this.subFoldIsEnd&&(o<=i+20||i+a+20>o)},e.prototype._loadMoreSubFold=function(t){var e=this;e.isLoadingSubFold=!0,this._getSubFoldedReply(t,this.subFoldedNext).then(function(t){if(0===t.code){var i=t.data;e.subFoldedNext=i.cursor.next,e.subFoldIsEnd=i.cursor.is_end;var o="";i.replies.forEach(function(t){o=e._createSubFoldedReplyItem(t),$(".comment-sub-fold-bilibili .comment-list").append(o)}),e.isLoadingSubFold=!1,e._needLoadMoreSubFold()&&e._loadMoreSubFold()}}).fail(function(){e.isLoadingSubFold=!1})},e.prototype._parentBlacklistDom=function(t,e,i){return['<div class="con '+(i==e?"no-border":"")+'">','<div class="user blacklist-font-color">黑名单用户</div>','<p class="text">由于黑名单设置，该评论已被隐藏。</p>','<div class="info">',t.floor?'<span class="floor">#'+t.floor+"</span>":"",this._createPlatformDom(t.content.plat),'<span class="time">'+this._formateTime(t.ctime)+"</span>",this._canDel(t.mid)?'<div class="operation btn-hover"><div class="spot"></div><div class="opera-list"><ul><li class="del" data-mid="'+t.mid+'">删除</li></ul></div></div>':"","</div>","</div>"].join("")},e.prototype._subBlacklistDom=function(t){return['<div class="reply-item reply-wrap" data-id="'+t.rpid+'">','<a class="reply-face"><img src="'+this.noface+'"></a>','<div class="reply-con">','<div class="user">','<span class="blacklist-font-color name">黑名单用户 </span> <span class="text-con">由于黑名单设置，该回复已被隐藏。</span>',"</div>","</div>",'<div class="info">','<span class="time">'+this._formateTime(t.ctime)+"</span>",this._canDel(t.mid)?'<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul><li class="del" data-mid="'+t.mid+'">删除</li></ul></div></div>':"","</div>","</div>"].join("")},e.prototype._setTop=function(t,e){return $.ajax({type:"post",url:p.setTop,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:t,action:e,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},e.prototype._delReply=function(t){var e={lottery:p.lotteryDel,normal:p.del}[t.type],i={oid:this.oid,type:this.pageType,jsonp:"jsonp"},o="lottery"===t.type?"lottery_id":"rpid";return i[o]=t.id,$.ajax({type:"POST",url:e,dataType:"json",data:i,xhrFields:{withCredentials:!0}})},e.prototype._likeReply=function(t,e){return $.ajax({type:"POST",url:p.like,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:t,action:e,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},e.prototype._hateReply=function(t,e){return $.ajax({type:"POST",url:p.hate,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:t,action:e,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},e.prototype._updateSubReplyByPage=function(t,e,i,o,a){var s=this;this._getSubReplyByPage(t,e).done(function(n){if(n&&0===n.code){var r=n.data.page,l=r.num*r.size>=r.count;i.find(".reply-box").html(s._createSubReplyList(n.data.replies,n.data.page.count,!0,t,a,l));var c=Math.ceil(n.data.page.count/n.data.page.size),d=i.find(".paging-box");i.find(".reply-box").attr("data-page",e).attr("data-total",n.data.page.count),c>1?d.paging({pageCount:c,current:e,backFn:function(e){s.$root.trigger("subReplyPageChange",{pid:t,page:e,parent:i,hasFolded:a})}}):i.find(".paging-box").html(""),s._fixEmojiPosition(),"function"==typeof o&&setTimeout(function(){o.call(null)},10)}}).fail(function(){})},e.prototype._registerEvent=function(t){function e(){$(window).off("scroll.comment").on("scroll.comment",function(){var t=o.$root.find(".bb-comment > .comment-send"),e=o.$root.find(".bb-comment > .comment-header");!o._isInView(o.$root)||o.loaded||o.loading||(o._showLoading("<span>loading...</span>"),o.edata?o.loadPage(1):o._getEmoji()),!o.noPage&&$(".comment-list").height()>$(window).height()&&(o._isInView(e,!0)?(t.insertAfter(e),o.sendPosition=1):o._isInView(o.$root.find(".bottom-page"),!0)&&(o.$root.find(".bb-comment").append(t),o.sendPosition=2))})}var o=this,a=this.$root;if(t)var a=$(t);a.off("click"),a.off("click.showMore").on("click.showMore",".btn-more",function(){var t=$(this).data("pid"),e=$(this).data("fold");o._updateSubReplyByPage(t,1,$(this).parents(".list-item:eq(0)"),null,e),s.customReport("replyCardCheckClick",{parentId:t})}),a.off("subReplyPageChange").on("subReplyPageChange",function(t,e){o._updateSubReplyByPage(e.pid,e.page,e.parent,null,e.hasFolded)}),a.off("replyPageChange").on("replyPageChange",function(t,e){o.loadPage(e.p,e.isBottom)}),a.on("click.openMiniLogin",".btn-open-mini-Login",function(){o.quickLogin()}),a.on("click.emoji",".comment-emoji",function(t){var e=$(this).siblings(".textarea-container").find("textarea"),i=$(this).offset().left-o.$root.offset().left,a=$(this).offset().top-o.$root.offset().top+$(this).outerHeight(),n=$(this).parents(".comment-list").length>0;e.focus(),o.emoji.show(e,i,a,n),this!==o.$root[0]&&$(".emoji-box").css("zIndex",10001);var r=$(this).prev().find(".comment-submit").data("rid");s.customReport("replyEmojiClick",{type:o.pageType,oid:o.oid,position:r?3:o.sendPosition}),t.stopPropagation()}),a.off("focus.textarea").on("focus.textarea","textarea",function(){$(this).parent().addClass("focus"),0===$(this).parents(".list-item").length&&(o.isSubReply=!1);var t=$(this).next().data("rid");s.customReport("replyInputClick",{type:o.pageType,oid:o.oid,position:t?3:o.sendPosition}),s.browser.version.mobile&&$(window).off("scroll.comment")}),$(window).off("resize.comment").on("resize.comment",function(){o._fixEmojiPosition()}),a.off("blur.textarea").on("blur.textarea","textarea",function(){$(this).parent().removeClass("focus"),s.browser.version.mobile&&e()}),a.off("input.textarea").on("input.textarea","textarea",function(){$(this).parent().removeClass("error")}),a.on("click.sendMsg",".comment-submit",function(){var t=$(this).parent(),e=$(this).siblings("textarea").val()||"",a=void 0,n=t.find(".comment-captcha");if(!$(this).hasClass("disabled")){n.length>0&&(a=n.find("input").val());var r=$(this).data("rid");s.customReport("replySendClick",{type:o.pageType,oid:o.oid,position:r?3:o.sendPosition});var l={rid:$(this).attr("data-rid"),pid:$(this).attr("data-pid"),msg:e,plat:1,code:a},c=$(this).parents(".list-item:eq(0)"),d=c.find(".reply-box"),p=+c.find(".reply-box").attr("data-page")||1,m=+c.find(".reply-box").attr("data-total")||0;o._sendMsg(t,l,function(t){l.rid?p!==Math.ceil(m/i)&&0!==m||o._appendSubReplyToTop(t,e,d):o._appendReplyToTop(t,e)})}}),a.on("click.report",".report",function(){if(!o.userStatus.isLogin)return void o.quickLogin();var t=$(this).parents(".reply-wrap:eq(0)"),e=t.data("id");e&&o._reportFB($(this),o.oid,o.pageType,e)}),a.on("click.blacklist",".blacklist",function(){if(!o.userStatus.isLogin)return void o.quickLogin();var t=$(this).parents(".reply-wrap:eq(0)"),e=t.find("[data-usercard-mid]:eq(0)").data("usercard-mid");e&&o._blackListFB($(this),o.oid,o.pageType,e,t)}),a.on("click.reply",".reply",function(){if(o.readOnly)return void(new n).show($(this),"评论区已被冻结，禁止发送评论",2e3,"ok");var t=$(this).parents(".list-item:eq(0)"),e=$(this).parents(".reply-wrap:eq(0)"),i=e.hasClass("reply-item"),a=o.control.child_input_text||(i?"回复 @"+e.find(".user .name").text()+" :":"请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。");o.isSubReply=i,o.atMsg="回复 @"+e.find(".user .name").text()+" :";var r=t.attr("data-id"),l=e.attr("data-id"),c=!o.userStatus.isLogin||o.userStatus.level_info&&o.userStatus.level_info.current_level<2&&o.userStatus.mid!=o.upId&&1!=o.userStatus.vipStatus&&o.userStatus.official_verify&&o.userStatus.official_verify.type==-1;if(t.siblings(".list-item").removeClass("open-reply").find(".comment-send").remove(),t.hasClass("open-reply")){var d=t.find(".comment-send .comment-submit"),p=d.attr("data-rid")!==d.attr("data-pid");i||p?c?"":t.find(".comment-send textarea").focus().prop("placeholder",a).val(""):(t.find(".comment-send").remove(),t.removeClass("open-reply"))}else t.find(".con").append(o._createReplyBox({isSub:!0})),t.addClass("open-reply"),c?"":t.find(".comment-send textarea").focus().prop("placeholder",a).val("");t.find(".comment-send button.comment-submit").attr("data-rid",r).attr("data-pid",l),s.customReport("replyCardReplyClick",{rpid:r})}),a.on("click",".follow-btn",function(){if(o.userStatus.isLogin){var t=$(this),e=$('.follow-btn[data-mid="'+t.data("mid")+'"]');t.hasClass("followed")?d.unFollow(t.data("mid"),function(i){if(0===i.code){var a={type:9,aid:o.oid,follow:!1};s.customReport("follow_click",a),o.trigger("follow",a),e.removeClass("followed").text("关注"),(new n).show(t,"取消关注成功!",500,"ok")}else(new n).show(t,i.message,500,"error")},t.attr("quiet"),122):d.follow(t.data("mid"),function(i){if(22006==i.code)return void $.getScript("//static.hdslb.com/plugins/attentionLimitPopup/attentionLimitPopup.js",function(){new attentionLimitPopup});if(0===i.code){var a={type:9,aid:o.oid,follow:!0};s.customReport("follow_click",a),o.trigger("follow",a),e.addClass("followed").text("已关注"),s.browser.version.mobile||$.getScript("//static.hdslb.com/common/js/followGroupDialog.js",function(){followGroupDialog(t.data("mid"),t.data("uname"),{showErrMsgInDialog:!1,onAddTagError:function(t){(new n).show($(".follow-dialog-window .submit"),t||"添加分组失败")},onSubmitError:function(t){(new n).show($(".follow-dialog-window .submit-move"),t||"移动分组失败")},onSubmitSuccess:function(){(new n).show($(".follow-dialog-window"),"加入分组成功")},onEmptyTagSubmit:function(){(new n).show($(".follow-dialog-window"),"加入分组成功")}})})}else(new n).show(t,i.message,500,"error")},122)}else s.browser.version.mobile?location.href="//passport.bilibili.com/login":$.getScript("https://static-s.bilibili.com/account/bili_quick_login.js",function(){window.biliQuickLogin(function(t){window.location.reload()})})}),a.on("click.delete",".del",function(){var t=$(this).parents(".reply-wrap:eq(0)"),e=+t.attr("data-id"),i=t.attr("data-lottery-id"),a=t.hasClass("list-item")?"删除评论后，评论下所有回复都会被删除":"删除评论后将不可恢复",s=$(this),r=s.attr("data-mid"),l=o.userStatus.mid==o.upId&&r!=o.upId;(new n).show(s,"<p>"+a+"</p><p>是否继续？</p>","button",function(){o._reportEvent(l?"upmaster_deletecomment":"user_deletecomment"),o._delReply({id:i||e,type:i?"lottery":"normal"}).done(function(i){0===i.code?((new n).show(t,"删除成功"),t.hasClass("reply-item")?t.remove():o.loadPage(o.pageInfo.num||1)):(new n).show(t,i.message||"操作失败"),o.trigger("delete",e,i)})})}),a.on("click.set-top",".set-top",function(){var t=$(this),e=t.parents(".list-item:eq(0)"),i=+e.attr("data-id"),a=e.hasClass("is-top"),s=a?0:1,r=a?"取消成功":"置顶成功";return o.hasUpTop&&!a?void(new n).show(e,"<p>您只能置顶一条评论哦</p><p>先取消原来的吧！</p>"):(o._setTop(i,s).done(function(t){t&&0===t.code?((new n).show(e,r),o.loadPage(1)):(new n).show(e,t.message||"操作失败"),o.trigger("setTop",{rid:i,action:s},t)}),void o._reportEvent(a?"upmaster_cancelstick":"upmaster_stick"))}),a.on("click.like",".like",function(){if(!o.userStatus.isLogin)return void o.quickLogin();var t,e=$(this),i=$(this).parents(".reply-wrap:eq(0)"),a=+i.attr("data-id"),r=e.siblings(".hate");t=e.hasClass("liked")?0:1,s.customReport("replyCardLikeClick",{rpid:a}),o._likeReply(a,t).then(function(i){if(i&&0===i.code){if(0===t){e.removeClass("liked");var s=+e.find("span").text()-1;e.find("span").text(s>0?s:"")}else if(1===t){e.addClass("liked");var s=+e.find("span").text()+1;e.find("span").text(s>0?s:""),r.removeClass("hated")}}else(new n).show(e,i.message||"操作失败");o.trigger("like",{rid:a,action:t},i)})}),a.on("click.hate",".hate",function(){if(!o.userStatus.isLogin)return void o.quickLogin();var t,e=$(this),i=$(this).parents(".reply-wrap:eq(0)"),a=+i.attr("data-id"),r=e.siblings(".like");s.customReport("replyCardHateClick",{rpid:a}),t=e.hasClass("hated")?0:1,o._hateReply(a,t).then(function(i){if(i&&0===i.code){if(0===t)e.removeClass("hated");else if(1===t&&(e.addClass("hated"),r.hasClass("liked"))){r.removeClass("liked");var s=+r.find("span").text()-1;r.find("span").text(s>0?s:"")}}else(new n).show(e,i.message||"操作失败");o.trigger("hate",{rid:a,action:t},i)})}),a.on("click.operation",".spot",function(t){$(".opera-list").hide(),$(this).siblings(".opera-list").show(),t.stopPropagation();var e=$(this).parents(".reply-wrap:eq(0)"),i=+e.attr("data-id");s.customReport("replyCardMoreClick",{rpid:i})}),$(document).off("click.hide-operation").on("click.hide-operation",function(){$(".opera-list").hide()}),a.off("mouseleave.operation").on("mouseleave.operation",".opera-list",function(t){$(".opera-list").hide()}),a.on("click.tab",".tabs-order li",function(){var t=$(this);t.hasClass("on")||(t.addClass("on").siblings().removeClass("on"),o.sort=+t.attr("data-sort"),o.loadPage(1)),"0"==t.attr("data-sort")&&(s.videoReport("playpage_comment_allcomment"),s.customReport("replyOrderClick",{ordering:"time"})),"2"==t.attr("data-sort")&&(s.videoReport("playpage_comment_hotcomment"),s.customReport("replyOrderClick",{ordering:"heat"}))}),a.on("click.moreHot",".more-hot",function(){o.$root.find(".tabs-order li").removeClass("on"),o.$root.find('.tabs-order li[data-sort="2"]').addClass("on"),o.sort=2,o.loadPage(1,!0),o.trigger("loadMoreHot")}),a.on("click.reload",".reload-comment",function(){o._showLoading("<span>loading...</span>"),o.loadPage(1),o.trigger("reload")}),a.on("click.notice",".reply-notice",function(){s.customReport("playpage_anoun")}),a.on("click.deletNotice",".icon-close-notice",function(){var t=$(this).parent(),e=+t.attr("data-id");if(f){var i=+window.localStorage.getItem(h);e>i&&window.localStorage.setItem(h,e)}t.remove(),o._reportEvent("comment_notice_close"),s.customReport("playpage_anoun_delete"),o.trigger("closeNotice")}),e(),a.on("click.captcha",".comment-captcha > img",function(){var t=$(this).get(0),e=t.src.indexOf("&_ts=");t.src=t.src.substr(0,e===-1?t.src.length:e)+"&_ts="+Date.now()}),a.on("click.hide",".hidden-reply-toggle",function(){$(this).siblings(".quote").slideToggle(200)}),a.on("click.notice",".notice-item a",function(){o._reportEvent("comment_notice_click")}),a.on("click.vote",".vote-container, .vote-link",function(){if(!o.userStatus.isLogin)return void o.quickLogin();var t=$(this).data("id"),e=$(this).data("name");s.browser.version.mobile&&(location.href="//t.bilibili.com/h5/dynamic/vote#/result?vote_id="+t+"&from=comment"),t&&o._voteFB($(this),t,e)}),a.on("click.lottery",".lottery-container, .lottery-link",function(){if(!o.userStatus.isLogin)return void o.quickLogin();var t=$(this).data("id");s.browser.version.mobile&&(location.href="//t.bilibili.com/lottery/h5/index/#/result?lottery_id="+t),t&&o._lotteryFB($(this),t)}),a.on("click.space",".user-face a, .reply-face",function(){var t=$(this).data("usercard-mid");o.trigger("clickSpace",{type:"face",mid:t});var e=$(this).parents(".reply-wrap:eq(0)"),i=+e.attr("data-id");s.customReport("replyCardProfileClick",{rpid:i})}),a.on("click.space",".name",function(){var t=$(this).data("usercard-mid");o.trigger("clickSpace",{type:"name",mid:t});var e=$(this).parents(".reply-wrap:eq(0)"),i=+e.attr("data-id");s.customReport("replyCardNameClick",{rpid:i})}),a.on("click.level",".level-link",function(){var t=$(this).parents(".reply-wrap:eq(0)"),e=+t.attr("data-id");s.customReport("replyCardLvClick",{rpid:e})}),a.on("click.moreLink",".more-link",function(){o.trigger("moreLinkClick")}),this.on("repostSuc",function(){var t=o.$root.find(".dynamic-repost-checkbox");t[0].checked=!1}),this.on("repostFail",function(t){var e=o.$root.find(".dynamic-repost"),i=t.data&&t.data.errmsg;(new n).show(e,i,2e3,"error")}),this.on("repostError",function(t){var e=o.$root.find(".dynamic-repost"),i=t.msg;(new n).show(e,i,2e3,"error")}),a.on("click.seek",".video-seek",function(){if(window.commentAgent&&"function"==typeof window.commentAgent.seek){var t=$(this).data("time"),e=$(this).data("p");e<0?(window.commentAgent.seek(t),s.customReport("reply_timelink_click",{time:t})):(window.commentAgent.seek(t,e),s.customReport("reply_timelink_click",{time:t,p:e})),window.scrollTo(0,0)}}),a.on("click.fold",".view-fold",function(){s.customReport("foldingreply-click",1),o._foldFB(this)}),a.on("click.fold",".view-sub-fold",function(){s.customReport("foldingreply-click",1);var t=$(this).data("root");o._subFoldFB(this,t)}),a.on("click.fold-rule",".fold-rule",function(){s.customReport("foldingreply-click",2)})},e.prototype._isInView=function(t,e){if(t.length){var i=$(window).height(),o=t.offset().top-$(window).scrollTop();return e?o<=i&&o>=0:o<=i}},e.prototype._showLoading=function(t){this.$root.find(".comment-loading").remove(),this.$root.find(".bb-comment").append('<div class="comment-loading">'+t+"</div>")},e.prototype._hideLoading=function(){this.$root.find(".comment-loading").remove()},e.prototype.jumpToReply=function(t){var e=this;e.emoji||(e.emoji=new r(e.$root,e.userStatus.vipStatus,e.edata)),this.jumpId=t,e.loading=!0,$.ajax({url:p.jump,dataType:"jsonp",data:{jsonp:"jsonp",rpid:t,oid:e.oid,type:e.pageType}}).done(function(i){if(e._hideLoading(),e.loaded=!0,0===i.code){e.mode=i.data.mode,e.blacklist=i.data.blacklist||0,e.assist=i.data.assist||0,e.pageInfo=i.data.page||{};var o=i.data.control;o&&(e.control.bg_text=o.bg_text,e.control.child_input_text=o.child_input_text,e.control.input_disable=o.input_disable,e.control.root_input_text=o.root_input_text,e.control.web_selection=o.web_selection),e._renderTabs(i),e._renderNotice(i.data.notice),e._updateReplyListByData(i.data,e.pageInfo.num),e._renderTopPagination(e.pageInfo),e._renderBottomPagination(e.pageInfo),$(".common .b-head .results").html(i.data.page.acount||0).show(),i.data&&i.data.config&&i.data.config.showentry?$(".common .b-head .del-log").show():$(".common .b-head .del-log").remove(),e.$root.find(".bb-comment > .comment-send").remove(),$(e._createReplyBox()).insertBefore(e.$root.find(".comment-list")),e.jumpId="",setTimeout(function(){var i=$('[data-id="'+t+'"]');if(!i.length)return $(window).scrollTop(e.$root.offset().top),void(window.console&&window.console.log("[comment] dom not find when jump"));if($(window).scrollTop(i.offset().top),i.hasClass("reply-item")){var o=i.parents(".list-item:eq(0)");e._updateSubReplyByPage(+o.attr("data-id"),e.pageInfo.rt_num,o,function(){$('[data-id="'+t+'"]').find(".reply").click()})}else i.hasClass("list-item")&&i.find(".con .reply").click()},100)}else 12002==i.code&&(e.$root.find(".bb-comment > .comment-send").remove(),$(e._createReplyBox({forbid:!0})).insertBefore(e.$root.find(".comment-list")))}).fail(function(){e.loaded||e._showLoading('<span>加载失败，<a class="reload-comment">点击重试</a></span>')}).always(function(){e.loading=!1})},e.prototype._showMessage=function(t,e){$("body").append('<div class="comment-msg"><span>'+t+"</span></div>"),setTimeout(function(){$(".comment-msg").remove()},e||2e3)},e.prototype._reportEvent=function(t,e){"function"==typeof window.rec_rp&&window.rec_rp("event",t,e)},e.prototype._appendReplyToTop=function(t,e){var i={rpid:t,mid:this.userStatus.mid,type:1,count:0,rcount:0,floor:"",state:0,attr:0,ctime:"刚刚",like:0,action:0,member:{mid:this.userStatus.mid,uname:s.unhtml(this.userStatus.uname),avatar:this.userStatus.face,level_info:this.userStatus.level_info,pendant:this.userStatus.pendant,nameplate:{nid:0,name:"",image:"",image_small:"",level:"",condition:""},official_verify:this.userStatus.officialVerify,vip:{vipType:this.userStatus.vipType,vipDueDate:this.userStatus.vipDueDate,dueRemark:this.userStatus.dueRemark,accessStatus:this.userStatus.accessStatus,vipStatus:this.userStatus.vipStatus,vipStatusWarn:"",themeType:this.userStatus.vip_theme_type}},content:{message:s.unhtml(e),plat:1,device:"",members:[]},replies:null},o=$(this._createReplyItem(i,1)),a=this.$root.find(".comment-list .list-item:eq(0)");if(a.length>0?a.before(o):(this.$root.find(".no-more-reply").remove(),this.$root.find(".comment-list").append(o)),this.mounted){var n=this.fbData;n.unshift(i),this.mounted(n)}},e.prototype._appendSubReplyToTop=function(t,e,i){var o={rpid:t,mid:this.userStatus.mid,type:1,count:0,rcount:0,floor:"",state:0,attr:0,ctime:"刚刚",like:0,action:0,member:{mid:this.userStatus.mid,uname:s.unhtml(this.userStatus.uname),avatar:this.userStatus.face,level_info:this.userStatus.level_info,pendant:this.userStatus.pendant,nameplate:{nid:0,name:"",image:"",image_small:"",level:"",condition:""},official_verify:this.userStatus.officialVerify,vip:{vipType:this.userStatus.vipType,vipDueDate:this.userStatus.vipDueDate,dueRemark:this.userStatus.dueRemark,accessStatus:this.userStatus.accessStatus,vipStatus:this.userStatus.vipStatus,vipStatusWarn:"",themeType:this.userStatus.vip_theme_type}},content:{message:s.unhtml(e),plat:1,device:"",members:[]},replies:null},a=$(this._createSubReplyItem(o));i.prepend(a),this._fixEmojiPosition()},t.bbComment=e}(window)},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e,i){function o(t,e,i){this.container=t,this.isVip=e,this.data=i,this.defaultEmojis=["(⌒▽⌒)","（￣▽￣）","(=・ω・=)","(｀・ω・´)","(〜￣△￣)〜","(･∀･)","(°∀°)ﾉ","(￣3￣)","╮(￣▽￣)╭","( ´_ゝ｀)","←_←","→_→","(<_<)","(>_>)","(;¬_¬)",'("▔□▔)/',"(ﾟДﾟ≡ﾟдﾟ)!?","Σ(ﾟдﾟ;)","Σ( ￣□￣||)","(´；ω；`)","（/TДT)/","(^・ω・^ )","(｡･ω･｡)","(●￣(ｴ)￣●)","ε=ε=(ノ≧∇≦)ノ","(´･_･`)","(-_-#)","（￣へ￣）","(￣ε(#￣) Σ","ヽ(`Д´)ﾉ","(╯°口°)╯(┴—┴","（#-_-)┯━┯","_(:3」∠)_","(笑)","(汗)","(泣)","(苦笑)"],this.currentSelect=0,this.curPage=1,this.totalPage=1,this.tabNum=5,this.tabWidth=58,this.avalEmojiNum=1,this.emojiData=[],this.emojiDom="<div class='emoji-box'><div class='emoji-title'><span></span></div><div class='emoji-wrap'></div><div class='emoji-tabs'><div class='emoji-container'><div class='emoji-tab-wrap clearfix'></div></div></div></div>",this.init()}i(6);var a=i(1);o.prototype={init:function(){$(this.container).find(".emoji-box").remove(),$(this.container).append(this.emojiDom),this.emojiBox=$(this.container).find(".emoji-box"),this.hide();var t=$(this.container).find(".emoji-tabs"),e=$(this.container).find(".emoji-wrap"),i=$(this.container).find(".emoji-title"),o=this,s=this.data.free,n=this.data.vip;this.freeLength=s.length,this.defaultCursor=s.length;for(var r=0;r<s.length;r++)this.emojiData.push(s[r]),0==n[r].pstate&&this.avalEmojiNum++;if(this.emojiData.push({pname:"颜文字",pid:-1,pstate:0,emojis:this.defaultEmojis,purl:"//static.hdslb.com/images/base/emoji-tab-default.png"}),this.isVip)for(var r=0;r<n.length;r++)this.emojiData.push(n[r]),0==n[r].pstate&&this.avalEmojiNum++;this.createTabs(t),this.createEmoji(e,i,this.emojiData[0].pid),t.off("click.tab").on("click.tab",".tab-link",function(){o.currentSelect=+$(this).attr("data-index");var t=+$(this).data("pid");o.oldCurrentSelect=o.currentSelect,$(this).addClass("on").siblings(".tab-link").removeClass("on"),o.createEmoji(e,i,t)}),e.off("click").on("click",".emoji-list",function(t){var e=$(this).attr("data-emoji-text");o.insertAtCursor($(o.ta)[0],e),o.emojiBox.hide();var i=$(this),s=i.data("pid"),n=i.data("id"),r=i.data("index"),l={};s?l={pid:s,id:n}:r&&(l={index:r}),a.customReport("emoji_click",l)}),$(document).off("click.offEmoji").on("click.offEmoji",function(t){o.emojiBox.is(t.target)||0!==o.emojiBox.has(t.target).length||o.emojiBox.hide()}),t.off("click.prev").on("click.prev",".prev",function(){o.curPage>1&&o.curPage--,o.updateTabSlide()}),t.off("click.next").on("click.next",".next",function(){o.curPage<o.totalPage&&o.curPage++,o.updateTabSlide()})},updateTabSlide:function(){var t=$(this.container).find(".emoji-tab-slider"),e=t.find(".prev"),i=t.find(".next");this.curPage>1?e.addClass("on"):e.removeClass("on"),this.curPage<this.totalPage?i.addClass("on"):i.removeClass("on"),$(this.container).find(".emoji-tab-wrap").css({left:-1*(this.curPage-1)*this.tabWidth*this.tabNum})},createTabs:function(t){var e="";this.totalPage=Math.ceil(this.avalEmojiNum/this.tabNum);for(var i=0;i<this.emojiData.length;i++)if(0==this.emojiData[i].pstate){var o=this.currentSelect==i?"on":"",s=this.emojiData[i].pid;e+="<a class='tab-link "+o+"' data-index='"+i+"' data-pid='"+s+"'><img src='"+a.trimHttp(a.webp(this.emojiData[i].purl,{w:44,h:44}))+"'></a>"}t.find(".emoji-tab-wrap").html(e).css({width:this.emojiData.length*this.tabWidth,left:0}),t.find(".emoji-tab-slider").remove(),this.totalPage>1&&t.append('<div class="emoji-tab-slider clearfix"><span class="prev"></span><span class="next on"></span></div>')},createEmoji:function(t,e,i){if(e.find("span").text(this.emojiData[this.currentSelect].pname),this.currentSelect==this.defaultCursor){for(var o="",s=0;s<this.emojiData[this.defaultCursor].emojis.length;s++)o+="<a class='emoji-list emoji-text emoji-default' data-emoji-text='"+this.emojiData[this.defaultCursor].emojis[s]+"' data-index='"+s+"'>"+this.emojiData[this.defaultCursor].emojis[s]+"</a>";t.html("").append(o)}else{for(var o="",n=this.emojiData[this.currentSelect].emojis,s=0;s<n.length;s++)if(0==n[s].state){var r="emoji-list emoji-text emoji-pic";n[s].size&&"s"===n[s].size&&(r+=" emoji-small");var l=n[s].id;o+="<a class='"+r+"' data-emoji-text='"+n[s].name+"' data-pid='"+i+"' data-id='"+l+"'><img src='"+a.trimHttp(a.webp(n[s].url,{w:56,h:56}))+"' title='"+n[s].name+"'></a>"}t.html("").append(o)}},insertAtCursor:function(t,e){if(document.selection)t.focus(),sel=document.selection.createRange(),sel.text=e,sel.select();else if(t.selectionStart||"0"==t.selectionStart){var i=t.selectionStart,o=t.selectionEnd,a=t.scrollTop;t.value=t.value.substring(0,i)+e+t.value.substring(o,t.value.length),a>0&&(t.scrollTop=a),t.focus(),t.selectionStart=i+e.length,t.selectionEnd=i+e.length}else t.value+=e,t.focus()},show:function(t,e,i,o){this.ta=t,this.emojiBox.show().css({left:e,top:i}),$(this.container).find(".emoji-tabs .tab-link"),$(this.container).find(".emoji-tab-slider")},hide:function(){this.emojiBox.hide()}},t.exports=o},function(t,e,i){i(8);var o={init:function(t,e){return function(){o.fillHtml(t,e),o.bindEvent(t,e)}()},fillHtml:function(t,e){return function(){t.empty(),e.smallSize&&t.addClass("small"),pageOffset=e.smallSize?1:2,e.pageCount>1&&!e.jump&&t.append('<span class="result">共'+e.pageCount+"页</span>"),e.current>1?t.append('<a href="javascript:;" class="prev">上一页</a>'):(t.remove(".prev"),t.append('<span class="disabled">上一页</span>')),1!=e.current&&e.current>=pageOffset+2&&e.pageCount!=pageOffset+2&&t.append('<a href="javascript:;" class="tcd-number">1</a>'),e.current-pageOffset>2&&e.current<=e.pageCount&&e.pageCount>pageOffset+3&&t.append('<span class="dian">...</span>');var i=e.current-pageOffset,o=e.current+pageOffset;for((i>1&&e.current<pageOffset+2||1==e.current)&&o++,e.current>e.pageCount-(pageOffset+2)&&e.current>=e.pageCount&&i--;i<=o;i++)i<=e.pageCount&&i>=1&&(i!=e.current?t.append('<a href="javascript:;" class="tcd-number">'+i+"</a>"):t.append('<span class="current">'+i+"</span>"));if(e.current+pageOffset<e.pageCount-1&&e.current>=1&&e.pageCount>pageOffset+3&&t.append('<span class="dian">...</span>'),e.current!=e.pageCount&&e.current<e.pageCount-pageOffset&&e.pageCount!=pageOffset+2&&t.append('<a href="javascript:;" class="tcd-number">'+e.pageCount+"</a>"),e.current<e.pageCount?t.append('<a href="javascript:;" class="next">下一页</a>'):(t.remove(".next"),t.append('<span class="disabled">下一页</span>')),e.pageCount>1&&e.jump){var a='<div class="page-jump">';e.smallSize||(a+="共<span>"+e.pageCount+"</span>页，"),a+='跳至<input type="text" />页</div>',t.append(a)}}()},bindEvent:function(t,e){return function(){t.off("click"),t.off("keydown"),t.on("click","a.tcd-number",function(){var i=parseInt($(this).text());o.fillHtml(t,{current:i,pageCount:e.pageCount,jump:e.jump}),"function"==typeof e.backFn&&e.backFn(i)}),t.on("click","a.prev",function(){var i=parseInt(t.children("span.current").text());o.fillHtml(t,{current:i-1,pageCount:e.pageCount,jump:e.jump}),"function"==typeof e.backFn&&e.backFn(i-1)}),t.on("click","a.next",function(){var i=parseInt(t.children("span.current").text());o.fillHtml(t,{current:i+1,pageCount:e.pageCount,jump:e.jump}),"function"==typeof e.backFn&&e.backFn(i+1)}),t.on("keydown","input",function(i){if(13==i.keyCode){var a=Math.abs(parseInt($(this).val())),s=a?a:1;s=s>e.pageCount?e.pageCount:s,o.fillHtml(t,{current:s,pageCount:e.pageCount,jump:e.jump}),"function"==typeof e.backFn&&e.backFn(s)}})}()}};t.exports=o},function(t,e,i){function o(t){if(!s.browser.version.mobile){var e={isLogin:!1,vipStatus:0,vipType:0,mid:null};this.userStatus=$.extend(e,t),s.browser.version.mobile||this._registerEvent()}}i(9);var a=i(2),s=i(1),n=i(3),r={},l=new a,c=0;o.prototype.reset=function(t){this.userStatus=t,r={}},o.prototype._renderCard=function(t){$(".user-card").remove(),$("body").append(this._createCard(t)),s.videoReport("playpage_namecard2")},o.prototype._renderErrorCard=function(){$(".user-card").remove(),$("body").append(this._createErrorCard())},o.prototype._renderLoadingCard=function(){$(".user-card").remove(),$("body").append(this._createLoadingCard())},o.prototype._isLikeMe=function(t){if(t.card&&t.card.attentions)for(var e=0,i=t.card.attentions.length;e<i;++e)if(t.card.attentions[e]===this.userStatus.mid)return!0;return!1},o.prototype._createCard=function(t){var e=t.space.s_img?t.space.s_img:"//i0.hdslb.com/bfs/static/c9dae917e24b4fc17c4d544caf6b6c0b17f8692b.jpg",i=0===t.card.official_verify.type?'<i title="个人认证" class="auth p-auth"></i>':"",o=1===t.card.official_verify.type?'<i title="企业/团体认证" class="auth o-auth"></i>':"",a="保密"===t.card.sex?"":"男"===t.card.sex?'<i class="sex men"></i>':'<i class="sex women"></i>',n=t.card.sign?'<p class="sign">'+s.unhtml(t.card.sign)+"</p>":"",r="";r=1===t.card.vip.theme_type&&2===t.card.vip.vipType?"vip-green-name":2===t.card.vip.vipType&&1===t.card.vip.vipStatus?"vip-red-name":"";var l=this._isLikeMe(t),c=t.following?"已关注":"+关注",d=t.following?"liked":"";return d+=l?" liked-me":"",'<div class="user-card"><div class="bg" style="background-image:url('+s.trimHttp(s.webp(e,{w:750,h:240}))+')"></div><a target="_blank" href="//space.bilibili.com/'+t.card.mid+'" class="face"><img src="'+s.trimHttp(s.webp(t.card.face,{
w:50,h:50}))+'" />'+i+o+'</a><div class="info"><p class="user"><a target="_blank" href="//space.bilibili.com/'+t.card.mid+'" class="name '+r+'">'+s.unhtml(t.card.name)+"</a>"+a+'<a href="//www.bilibili.com/html/help.html#k_'+t.card.level_info.current_level+'" target="_blank"><i class="level l'+t.card.level_info.current_level+'"></i></a></p><p class="social"><a href="//space.bilibili.com/'+t.card.mid+'/#!/fans/follow" target="_blank">关注: <span class="like">'+t.card.friend+'</span></a><a href="//space.bilibili.com/'+t.card.mid+'/#!/fans/fans" target="_blank">粉丝: <span class="fans">'+s.formatNum(t.card.fans)+"</span></a></p>"+n+'</div><div class="btn-box"><a class="like '+d+'" mid="'+t.card.mid+'" uname="'+s.unhtml(t.card.name)+'"'+(t.quiet?' quiet="true"':"")+'><span class="default-text">'+c+'</span><span class="hover-text">取消关注</span></a><a href="//message.bilibili.com/#whisper/mid'+t.card.mid+'" target="_blank" class="message">发消息</a></div></div>'},o.prototype._createErrorCard=function(){return'<div class="user-card"><p class="error-card">加载失败</p></div>'},o.prototype._createLoadingCard=function(){return'<div class="user-card"><p class="loading-card">正在加载中...请稍后。</p></div>'},o.prototype._setPosition=function(t){var e=$(t).offset().left,i=$(t).offset().top;if($(t).outerWidth(),$(t).offset().top<$(window).scrollTop()+$(".user-card").height()+32)var o=i+$(t).outerHeight()+8;else var o=i-$(".user-card").height()-32;$(t.height),$(".user-card").css({left:e,top:o})},o.prototype._registerEvent=function(){var t=this;$("body").off("click.userCardAttention").on("click.userCardAttention",".user-card .btn-box .like",function(){if(t.userStatus.isLogin){var e=$(this).hasClass("liked"),i=($(this).hasClass("liked-me"),$(this).attr("mid")),o=$(this).attr("uname"),a=this;e?(l.unFollow(i,function(t){t&&0===t.code?($(a).removeClass("liked").find(".default-text").text("+关注"),delete r[i],(new n).show($(a),"取消关注成功!",1e3,"ok")):t&&(new n).show($(a),t.message,1e3,"error")},$(this).attr("quiet")),s.videoReport("playpage_unfollow2")):(l.follow(i,function(t){22006==t.code?$.getScript("//static.hdslb.com/plugins/attentionLimitPopup/attentionLimitPopup.js",function(){new attentionLimitPopup}):t&&0===t.code?($(a).text("取消关注").addClass("liked"),$.getScript("//static.hdslb.com/common/js/followGroupDialog.js",function(){$(".user-card").remove(),followGroupDialog(i,o,{showErrMsgInDialog:!1,onAddTagError:function(t){(new n).show($(".follow-dialog-window .submit"),t||"添加分组失败")},onSubmitError:function(t){(new n).show($(".follow-dialog-window .submit-move"),t||"移动分组失败")},onSubmitSuccess:function(){(new n).show($(".follow-dialog-window"),"加入分组成功")},onEmptyTagSubmit:function(){(new n).show($(".follow-dialog-window"),"加入分组成功")}})}),delete r[i]):t&&(new n).show($(a),t.message,1e3,"error")}),s.videoReport("playpage_follow2"))}else document.location.href="https://account.bilibili.com/login"}),$("body").on("mouseenter.data-userCard","[data-usercard-mid]",function(e){var i=$(this).attr("data-usercard-mid"),o=this;clearTimeout(c),c=setTimeout(function(){var e=$(o).parents(".reply-wrap:eq(0)"),a=+e.attr("data-id"),n=$(o).parent().hasClass("user-face"),l=$(o).hasClass("name");n&&s.customReport("replyCardProfileHover",{rpid:a}),l&&s.customReport("replyCardNameHover",{rpid:a}),r[i]?(t._renderCard(r[i]),t._setPosition(o)):(t._renderLoadingCard(),t._setPosition(o),$.ajax({url:"//api.bilibili.com/x/web-interface/card",dataType:"jsonp",data:{mid:i,photo:1,jsonp:"jsonp"},dataType:"jsonp",cache:!0,success:function(e){e&&0===e.code&&$.ajax({url:"//api.bilibili.com/x/relation",data:{fid:i,jsonp:"jsonp"},dataType:"jsonp"}).done(function(i){i&&0===i.code?(e.data.following=1===i.data.attribute||2===i.data.attribute||6===i.data.attribute,e.data.quiet=1===i.data.attribute):e.data.following=!1,t._renderCard(e.data),t._setPosition(o),r[e.data.card.mid]=e.data}).fail(function(){t._renderErrorCard(),t._setPosition(o)})},error:function(){t._renderErrorCard(),t._setPosition(o)}}))},300)}),$("body").on("mouseleave.data-userCard","[data-usercard-mid]",function(t){clearTimeout(c),c=setTimeout(function(){$(".user-card").remove()},100)}),$("body").on("mouseenter.userCard",".user-card",function(t){clearTimeout(c)}),$("body").on("mouseleave.userCard",".user-card",function(t){$(".user-card").remove()})},t.exports=o}]);